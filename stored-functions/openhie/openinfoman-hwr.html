<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="urn:ihe:iti:csd:2013" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:csd="urn:ihe:iti:csd:2013" xmlns:xforms="http://www.w3.org/2002/xforms">
  <head>
    <style type="text/css">
          div {
          border-radius: 1em 1em 1em 1em;
          }
          .function {
          background-color: #feedff;
          width:90%;
          magin-top:2em;
          padding-bottom:1em;
          padding-left:1em;
	  box-shadow:0 6px 2px 0 #CCCCCC;
          }
	  .source {
	  overflow:auto;
	  }
          .attribute{
          border-radius: 1em 1em 1em 1em;
          background-color: #FBFBEF;                    
          font-style: italic;
          font-weight: lighter;
          height: auto;
          float:right;
          margin-right:2em;
          margin-left: 1em;
          padding: 2em;
	  box-shadow:0 4px 2px 0 #CCCCCC;
          }
          .callout{
          background: none repeat scroll 0 0 #EEEEEE;
          margin: 1em;
          overflow: auto;
          padding: 1em 2em;
          width: auto;
	  box-shadow:0 6px 2px 0 #CCCCCC;
          }
          .callout h2 {
          background-color: #EEFFFF;
          border-radius: 0.5em 0.5em 0.5em 0.5em;
          padding: 0.2em 0.2em 0.2em 1em;
          }
          pre {
          font-family: "Courier New",Courier,monospace;
          font-size: 0.8em;
	  overflow:scroll;
          }
	  li i.urn {
	  display:inline-block;
	  min-width:18em;
	  max-width:18em;
	  width:18em;
	  }
        </style>
  </head>
  <body>
    <div class="function">
      <h2>Stored Functions</h2>
      <ul>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:bulk_health_worker_read_otherids_json</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:bulk_health_worker_read_otherids_json">bulk_health_worker_read_otherids_json</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_get_urns</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_get_urns">facility_get_urns</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_address">facility_indices_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_contact_point">facility_indices_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_organization</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_organization">facility_indices_organization</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_otherid">facility_indices_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service">facility_indices_service</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_name_search</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_name_search"> 
    
    Performs a search for all facilities by name, type, address or ID.   
    
    
      The...</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_read_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_read_address">facilty_read_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_read_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_read_contact_point">facility_read_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_read_organization</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_read_organization">facility_read_organization</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_read_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_read_otherid">facility_read_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_read_service</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_read_service">facility_read_service</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_get_urns</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_get_urns">health_worker_get_urns</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_address">health_worker_indices_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_contact_point">health_worker_indices_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_credential">health_worker_indices_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_name</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_name">health_worker_indices_name</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_operating_hours">health_worker_indices_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_address">health_worker_indices_org_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_contact_point">health_worker_indices_org_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_otherid">health_worker_indices_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_facility</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_facility">health_worker_indices_provider_facility</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_organization</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_organization">health_worker_indices_provider_organization</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service">health_worker_indices_service</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_address">health_worker_read_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_contact_point">health_worker_read_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_credential">health_worker_read_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_name</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_name">health_worker_read_name</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_operating_hours">health_worker_read_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_address">health_worker_read_org_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_contact_point">health_worker_read_org_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherid">health_worker_read_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids">health_worker_read_otherids</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids_json</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids_json">health_worker_read_otherids_json</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider">health_worker_read_provider</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_facility</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_facility">health_worker_read_provider_facility</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_organization</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_organization">health_worker_read_provider_organization</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_service</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_service">health_worker_read_service</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_urn_search_by_id</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_urn_search_by_id">health_worker_urn_search_by_id</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_get_urns</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_get_urns">organization_get_urns</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_address">organization_indices_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_contact_point">organization_indices_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_credential">organization_indices_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_otherid">organization_indices_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_name_search</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_name_search"> 
    
    Performs a search for all organizations by name, coded type, address or ID.   
    
    
...</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_read_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_read_address">facilty_read_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_read_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_read_contact_point">organization_read_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_read_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_read_credential">organization_read_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_read_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_read_otherid">organization_read_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:provider_name_search</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:provider_name_search">
     Performs a search for all providers by name, coded type, address or ID. 
     The result set c...</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:service_get_urns</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:service_get_urns">service_get_urns</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address">facility_create_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_create_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_create_contact_point">facility_create_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_create_geocode</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_create_geocode">facility_create_geocode</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_create_language</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_create_language">facility_create_language</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_create_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_create_operating_hours">facility_create_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_create_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_create_otherid">facility_create_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_address">facility_delete_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_contact_point">facility_delete_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_geocode</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_geocode">facility_delete_geocode</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_language</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_language">facility_delete_language</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_name</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_name">facility_delete_name</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_operating_hours">facility_delete_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_otherid">facility_delete_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_update_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_update_address">facility_update_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_update_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_update_contact_point">facility_update_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_update_name</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_update_name">facility_update_name</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_update_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_update_operating_hours">facility_update_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_update_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_update_otherid">facility_update_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_address">health_worker_create_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_contact_point">health_worker_create_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_credential">health_worker_create_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_name</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_name">health_worker_create_name</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_operating_hours">health_worker_create_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_address">health_worker_create_org_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_contact_point">health_worker_create_org_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_otherid">health_worker_create_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider">health_worker_create_provider</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_facility</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_facility">health_worker_create_provider_facility</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_organization</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_organization">health_worker_create_provider_organization</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_service</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_service">health_worker_create_service</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_address">health_worker_delete_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_contact_point">health_worker_delete_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_credential">health_worker_delete_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_name</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_name">health_worker_delete_name</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_operating_hours">health_worker_delete_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_address">health_worker_delete_org_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_contact_point">health_worker_delete_org_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_otherid">health_worker_delete_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider">health_worker_delete_provider</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_facility</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_facility">health_worker_delete_provider_facility</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_organization</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_organization">health_worker_delete_provider_organization</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_service</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_service">health_worker_delete_service</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_address">health_worker_update_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_contact_point">health_worker_update_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_credential">health_worker_update_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_name</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_name">health_worker_update_name</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_operating_hours</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_operating_hours">health_worker_update_operating_hours</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_address">health_worker_update_org_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_contact_point">health_worker_update_org_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_otherid">health_worker_update_otherid</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider">health_worker_update_provider</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_facility</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_facility">health_worker_update_provider_facility</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_organization</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_organization">health_worker_update_provider_organization</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_service</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_service">health_worker_update_service</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address">facility_create_address</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_create_contact_point</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_create_contact_point">organization_create_contact_point</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_create_credential</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_create_credential">organization_create_credential</a>
        </li>
        <li>
          <i class="urn">urn:openhie.org:openinfoman-hwr:stored-function:organization_create_otherid</i>
          <a style="position:relative;left:2em" href="#urn:openhie.org:openinfoman-hwr:stored-function:organization_create_otherid">organization_create_otherid</a>
        </li>
      </ul>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:bulk_health_worker_read_otherids_json"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        application/json<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:bulk_health_worker_read_otherids_json</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">bulk_health_worker_read_otherids_json</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;




(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 


let $code := $careServicesRequest/code/text()
let $aa := $careServicesRequest/assigningAuthorityName/text()

let $xml:= 
  &lt;json  type="object"&gt;
    &lt;results type='array'&gt;
      { 
      for $ent_id in $careServicesRequest/id
      let $req_id := upper-case(string($ent_id/@entityID))
      let $provider := (/CSD/providerDirectory/provider[upper-case(string(@entityID)) = $req_id])[1]
      let $other_ids_0 := 
	if ($code) 
	then $provider/otherID[@code = $code]
	else $provider/otherID
      let $other_ids_1 := 
	if ($aa) 
	then $other_ids_0[@assigningAuthorityName = $aa]
        else $other_ids_0

      return
	if (exists($provider) and count($other_ids_1) &gt; 0)
	then
	  &lt;_ type='object'&gt;
	    &lt;entityID&gt;{string($provider/@entityID)}&lt;/entityID&gt;	    
	    &lt;otherID type="array"&gt;
	      {
		for $id in $other_ids_1
		return       
		  &lt;_ type='object'&gt;
		    &lt;code&gt;{string($id/@code)}&lt;/code&gt;
		    &lt;authority&gt;{string($id/@assigningAuthorityName)}&lt;/authority&gt;
		    &lt;value&gt;{$id/text()}&lt;/value&gt;
		  &lt;/_&gt;
	        }
	    &lt;/otherID&gt;
	 &lt;/_&gt;
	else ()
	      
      }
    &lt;/results&gt;
  &lt;/json&gt;
return json:serialize($xml,map{"format":"direct"})  
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_get_urns"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_get_urns</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_get_urns</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $facs0 := if (exists($careServicesRequest/id)) then csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else /CSD/facilityDirectory/*
  let $facs1 := if (exists($careServicesRequest/otherID)) then csd_bl:filter_by_other_id($facs0,$careServicesRequest/otherID) else $facs0
  let $facs2 := if (exists($careServicesRequest/codedType)) then csd_bl:filter_by_coded_type($facs1,$careServicesRequest/codedType)    else $facs1
  let $facs3 := if (exists($careServicesRequest/address/addressLine)) then csd_bl:filter_by_address($facs2, $careServicesRequest/address/addressLine) else $facs2
  let $facs4 := if (exists($careServicesRequest/record)) then csd_bl:filter_by_record($facs3,$careServicesRequest/record) else $facs3
  let $facs5 := if (exists($careServicesRequest/start) and exists($careServicesRequest/max)) then csd_bl:limit_items($facs4,$careServicesRequest/start,$careServicesRequest/max) else $facs4
  let $facs6 := for $entityID in $facs5/@entityID         
   return &lt;facility entityID="{$entityID}"/&gt;

  return csd_bl:wrap_facilities(($facs6))
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_indices_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $facs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) 
    else (/CSD/facilityDirectory/*)
  let $facs1:=     
      for $facility in  $facs0
      return
      &lt;facility entityID="{$facility/@entityID}"&gt;
	  {
	    for $address in  $facility/address
	    return &lt;address type="{$address/@type}"/&gt; 
	  }
      &lt;/facility&gt;
      
    return csd_bl:wrap_facilities($facs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_indices_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $facs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) 
    else (/CSD/facilityDirectory/*)
  let $facs1:=     
      for $facility in  $facs0
      return
      &lt;facility entityID="{$facility/@entityID}"&gt;
	  {
	    for $cp at $pos  in  $facility/contactPoint
	    return &lt;contactPoint position="{$pos}"/&gt; 
	  }
    &lt;/facility&gt;
      
    return csd_bl:wrap_facilities($facs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_organization"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_organization</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_indices_organization</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $facs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) 
    else (/CSD/facilityDirectory/*)
  let $facs1:=     
      for $facility in  $facs0
      return
      &lt;facility entityID="{$facility/@entityID}"&gt;
	&lt;organizations&gt;
          {
	    for $org in $facility/organizations/organization 
	    return
	    &lt;organization entityID="{$org/@entityID}"&gt;&lt;/organization&gt;
	  }
	&lt;/organizations&gt;
      &lt;/facility&gt;
      
    return csd_bl:wrap_facilities($facs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_indices_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_indices_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>
import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $facs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) 
    else (/CSD/facilityDirectory/*)
  let $facs1:=     
      for $facility in  $facs0
      return
      &lt;facility entityID="{$facility/@entityID}"&gt;
	{
	  for $id at $pos  in  $facility/otherID
	  return &lt;otherID position="{$pos}"/&gt; 
	}
    &lt;/facility&gt;
      
    return csd_bl:wrap_facilities($facs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_indices_service</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $facs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) 
    else (/CSD/facilityDirectory/*)
  let $facs1:=     
      for $facility in  $facs0
      return
      &lt;facility entityID="{$facility/@entityID}"&gt;
	&lt;organizations&gt;
	  {
	    let $facs := 
	      if (exists($careServicesRequest/organization/@entityID)) 
		then 
		$facility/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
	      else    $facility/organizations/organization
            for $fac in $facs
	      return 
	       &lt;organization entityID="{$fac/@entityID}"&gt;
		  {
		    for $srvc at $pos in $fac/service
		    return &lt;service position="{$pos}" entityID="{$srvc/@entityID}"/&gt; 
		  }
		&lt;/organization&gt;
	  }
	&lt;/organizations&gt;
    &lt;/facility&gt;
      
    return csd_bl:wrap_facilities($facs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_name_search"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_name_search</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source"> 
    
    Performs a search for all facilities by name, type, address or ID.   
    
    
      The result set consists of the primary name of all facilities matching the  search parameters ( id, primaryName, name, codedType and address ).
     
        
      The results set may be further restricted according to the limit parameters (start, max, record/@status and record/@updated).  An ordering of the result set is not specified.
    
    
    Response
    Results are returned as a valid CSD document with a root document element of &lt;CSD/&gt;.  The results set is contained entirely within the &lt;facilityDirectory/&gt; element and consists of the full content of the &lt;facility/&gt; elements of matching facilities as maintained by the Care Services InfoManager.
    
    Parameters Query
    Parameters are defined as the content of following elements:
    
       &lt;id/&gt; csd:uniqueID: (optional) If present and the @urn attribute contains a non-empty value, it is a ID which uniquely identifies a facility. This is an exact match.  
      
      &lt;primaryName/&gt; xs:string: (optional) If present and contains a non-empty value, then the result set should be restricted to those facilities whose &lt;primaryName/&gt; contains this value. Case insensitive.
      &lt;name/&gt; xs:string: (optional) If present and contains a non-empty value, then the result set should be restricted to those facilities which have a &lt;primaryName/&gt; or &lt;otherName/&gt; element containing this value. Case insensitive.      
      &lt;codedType/&gt; csd:codedtype:  If present and contains a non-empty value the result set should be restricted to those facilities whose &lt;codedType/@code&gt; equals this value for the coding schema specified by the @codingSchema attribute.  Case insensitive.
      
       &lt;address/&gt; csd:address: (optional) Contains of any-number of child &lt;addressLine/&gt; elements as follows:
        
          Text content xs:string: (optional) If present and contains a non-empty value, then the results set should be restricted to those facilities whose have an &lt;addressLine/&gt; with specified @component containing this value exactly.  Case insensitive.
           
          @component xs:string : (Required attribute) The component of the address we are searching. Case insensitive.
          
      
      &lt;start/&gt;  xs:int: (optional) The starting index for results returned. Defaults to 1, which indexes the first facility matching the search parameters
      &lt;max/&gt;  xs:int: (optional) The maximum number of results returned.  A value of less than zero implies no maximum.
      
	&lt;record/&gt;  csd:record : (optional) A child element to limit results according to
	
	  @status xs:string: (optional) If present and contains a non-empty value, the result set should be restricted to those facilities whose record/@status equals this value.  Case insensitive.
	  @updated xs:dateTime: (optional) If present and contains a non-empty value, the result set should be restricted to those facilities whose record/@updated is at least the given value.
	
      
    
    Example Request
    
         &lt;careServicesRequest&gt;
           &lt;function uuid='c7640530-f600-11e2-b778-0800200c9a66'&gt;
               &lt;codedType code='OPC' codingSchema="USDVA"/&gt;
               &lt;address&gt;
                 &lt;addressLine component='city'&gt;Chapel Hill&lt;/addressLine&gt;
	       &lt;/address&gt;
               &lt;max&gt;5&lt;/max&gt;
           &lt;/function&gt;
         &lt;/careServicesRequest&gt;         
      
  </span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare  variable $careServicesRequest as item() external;



(: 
   The query will be executed against the root element of the CSD document.
    
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
&lt;CSD xmlns:csd="urn:ihe:iti:csd:2013"  &gt;
  &lt;organizationDirectory/&gt;
  &lt;serviceDirectory/&gt;
  &lt;facilityDirectory&gt;
    {
      let $facs0 := if (exists($careServicesRequest/id))
	then csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id)
      else /CSD/facilityDirectory/*
         
      let $facs1 := if (exists($careServicesRequest/primaryName))
	then csd_bl:filter_by_primary_name($facs0,$careServicesRequest/primaryName)
      else $facs0
         
      let $facs2 := if (exists($careServicesRequest/name))
	then csd_bl:filter_by_name($facs1,$careServicesRequest/name)
      else $facs1
    
      let $facs3 := if(exists($careServicesRequest/codedType))
	then csd_bl:filter_by_coded_type($facs2,$careServicesRequest/codedType) 
      else $facs2
   
      let $facs4 := if(exists($careServicesRequest/address/addressLine))
	then csd_bl:filter_by_address($facs3, $careServicesRequest/address/addressLine) 
      else $facs3

      let $facs5 := if (exists($careServicesRequest/record))
	then csd_bl:filter_by_record($facs4,$careServicesRequest/record)      
      else $facs4

      let $facs6 := if(exists($careServicesRequest/otherID))
	then csd_bl:filter_by_other_id($facs5,$careServicesRequest/otherID)      
      else $facs5

      let $facs7:= if (exists($careServicesRequest/start)) then
	if (exists($careServicesRequest/max)) 
	  then csd_bl:limit_items($facs6,$careServicesRequest/start,$careServicesRequest/max)         
	else csd_bl:limit_items($facs6,$careServicesRequest/start,&lt;max/&gt;)         
      else
	if (exists($careServicesRequest/max)) 
	  then csd_bl:limit_items($facs6,&lt;start/&gt;,$careServicesRequest/max)         
	else $facs6

      return for $fac in $facs7
        return 
	 &lt;facility entityID='{$fac/@entityID}'&gt;
	   {$fac/primaryName}
	 &lt;/facility&gt;


    }     
  &lt;/facilityDirectory&gt;
  &lt;providerDirectory/&gt;
&lt;/CSD&gt;
    </pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_read_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_read_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facilty_read_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $facs0 := if (exists($careServicesRequest/address/@type)) then /CSD/facilityDirectory/*  else ()
let $facs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($facs0,$careServicesRequest/id) else ()
let $facs2 := 
  if (count($facs1) = 1) 
    then 
    let $facility :=  $facs1[1] 
    return 
    &lt;facility entityID="{$facility/@entityID}"&gt;
	{(
	  for $address in $facility/address[@type = $careServicesRequest/address/@type]
	  return $address
	 )}
      {$facility/record}
    &lt;/facility&gt;
  else ()        
return csd_bl:wrap_facilities($facs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_read_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_read_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_read_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $facs0 := if (exists($careServicesRequest/contactPoint/@position)) then /CSD/facilityDirectory/*  else ()
let $facs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($facs0,$careServicesRequest/id) else ()
let $facs2 := 
  if (count($facs1) = 1) 
    then 
    let $facility :=  $facs1[1] 
    return 
    &lt;facility entityID="{$facility/@entityID}"&gt;
      {
	if (exists($careServicesRequest/contactPoint) and exists($careServicesRequest/contactPoint/@position)) 
	  then 
	      for $cp in $facility/contactPoint[position() = $careServicesRequest/contactPoint/@position]
	      return       &lt;contactPoint position="{$careServicesRequest/contactPoint/@position}"&gt;{$cp/*}&lt;/contactPoint&gt;
	else
	  ()
      }
      {$facility/record}
    &lt;/facility&gt;
  else ()    
    
return csd_bl:wrap_facilities($facs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_read_organization"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_read_organization</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_read_organization</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $facs0 := if (exists($careServicesRequest/organization/@entityID)) then /CSD/facilityDirectory/*  else ()
let $facs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($facs0,$careServicesRequest/id) else ()
let $facs2 := 
  if (count($facs1) = 1) 
    then 
    let $facility :=  $facs1[1] 
    return 
      &lt;facility entityID="{$facility/@entityID}"&gt;
	  {
	    (
	    &lt;organizations&gt;
	      {
		for $org in $facility/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID ) ]
		return
		&lt;organization entityID="{$org/@entityID}"&gt;&lt;/organization&gt;
	      }
	    &lt;/organizations&gt;
	       
	      ,
	      $facility/record
	    )
	  }
      &lt;/facility&gt;
  else ()    
    
return csd_bl:wrap_facilities($facs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_read_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_read_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_read_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $facs0 := if (exists($careServicesRequest/otherID/@position)) then /CSD/facilityDirectory/*  else ()
let $facs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($facs0,$careServicesRequest/id) else ()
let $facs2 := 
  if (count($facs1) = 1) 
    then 
    let $facility :=  $facs1[1] 
    return 
    &lt;facility entityID="{$facility/@entityID}"&gt;
      {(
	if (exists($careServicesRequest/otherID/@position))
	  then 
	  for $id in $facility/otherID[position() = $careServicesRequest/otherID/@position]
	  return       
	  &lt;otherID 
	  position="{$careServicesRequest/otherID/@position}"
	  code="{$id/@code}"
	  assigningAuthorityName="{$id/@assigningAuthorityName}"&gt;{string($id)}&lt;/otherID&gt;
	else
	  ()
        ,      
	$facility/record
	)}
    &lt;/facility&gt;
  else ()    
    
return csd_bl:wrap_facilities($facs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_read_service"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_read_service</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_read_service</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $facs0 := if (exists($careServicesRequest/organization/@entityID)) then /CSD/providerDirectory/*  else ()
let $facs1 := if (exists($careServicesRequest/organization/service/@position)) then $facs0  else ()
let $facs2 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($facs1,$careServicesRequest/id) else ()
let $facs3 := 
  if (count($facs2) = 1) 
    then 
    let $facility :=  $facs2[1] 
    return 
    &lt;facility entityID="{$facility/@entityID}"&gt;
      {
	if (exists($careServicesRequest/organization/@entityID) and exists($careServicesRequest/organization/service/@position)) 
	  then 
	  &lt;organizations&gt;
	    &lt;organization entityID="{$careServicesRequest/organization/@entityID}"&gt;
	    {
	      for $srvc in $facility/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]/service[position() = $careServicesRequest/organization/service/@position]
	      return       &lt;service position="{$careServicesRequest/organization/service/@position}" entityID="{$srvc/@entityID}"&gt;{$srvc/*}&lt;/service&gt;
	  }
	    &lt;/organization&gt;
	  &lt;/organizations&gt;
	else
	  ()
      }
      {$facility/record}
    &lt;/facility&gt;
  else ()    
    
return csd_bl:wrap_facilities($facs3)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_get_urns"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_get_urns</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_get_urns</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := if (exists($careServicesRequest/id)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else /CSD/providerDirectory/*
  let $provs1 := if (exists($careServicesRequest/otherID)) then csd_bl:filter_by_other_id($provs0,$careServicesRequest/otherID) else $provs0
  let $provs2 := if (exists($careServicesRequest/commonName)) then csd_bl:filter_by_common_name($provs1,$careServicesRequest/commonName) else $provs1
  let $provs3 := if (exists($careServicesRequest/codedType)) then csd_bl:filter_by_coded_type($provs2,$careServicesRequest/codedType)    else $provs2
  let $provs4 := if (exists($careServicesRequest/address/addressLine)) then csd_bl:filter_by_address($provs3, $careServicesRequest/address/addressLine) else $provs3
  let $provs5 := if (exists($careServicesRequest/record)) then csd_bl:filter_by_record($provs4,$careServicesRequest/record) else $provs4
  let $provs6 := if (exists($careServicesRequest/start) and exists($careServicesRequest/max)) then csd_bl:limit_items($provs5,$careServicesRequest/start,$careServicesRequest/max) else $provs5
  let $provs7 := for $entityID in $provs6/@entityID         
   return &lt;provider entityID="{$entityID}"/&gt;

  return csd_bl:wrap_providers($provs7)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;demographic&gt;
	  {
	    for $address in  $provider/demographic/address
	    return &lt;address type="{$address/@type}"/&gt; 
	  }
	&lt;/demographic&gt;
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;demographic&gt;
	  {
	    for $cp at $pos  in  $provider/demographic/contactPoint
	    return &lt;contactPoint position="{$pos}"/&gt; 
	  }
	&lt;/demographic&gt;
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
        {
	  for $cred in $provider/credential
	  return
	  &lt;credential &gt;{$cred/codedType}&lt;/credential&gt;
	}
      &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_name"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_name</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_name</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;demographic&gt;
	  {
	    for $name at $pos  in  $provider/demographic/name
	    return &lt;name position="{$pos}"/&gt; 
	  }
	&lt;/demographic&gt;
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;facilities&gt;
	  {
	    let $facs := 
	      if (exists($careServicesRequest/facility/@entityID)) 
		then 
		$provider/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]
	      else    $provider/facilities/facility
            for $fac in $facs
	      return 
	       &lt;facility entityID="{$fac/@entityID}"&gt;
		  {
		    if ($careServicesRequest/facility/service/@position) 
		      then
			for $srvc in $fac/service[position()= $careServicesRequest/facility/service/@position] 
			return 
			&lt;service position="{$careServicesRequest/facility/service/@position}"&gt;
			  {for $oh at $ohpos in $srvc/operatingHours return &lt;operatingHours position="{$ohpos}"/&gt;}
			&lt;/service&gt;
		    else 
		      for $srvc at $spos in $fac/service
			return 
			&lt;service position="{$spos}"&gt;
			  {for $oh at $ohpos in $srvc/operatingHours return &lt;operaingHours position="{$ohpos}"/&gt;}
			&lt;/service&gt;
		  }
		&lt;/facility&gt;
	  }
	&lt;/facilities&gt;
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_org_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;organizations&gt;
          {
	    let $orgs := 
	      if (exists($careServicesRequest/organization/@entityID)) 
		then 
		$provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
	      else    $provider/organizations/organization
            for $org in $orgs
	      return 
	       &lt;organization entityID="{$org/@entityID}"&gt;
		  {
		    for $address  in $org/address
		    return &lt;address type="{$address/@type}"/&gt; 
		  }
		&lt;/organization&gt;
	  }
	&lt;/organizations&gt;
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_org_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_org_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;organizations&gt;
	  {
	    let $orgs := 
	      if (exists($careServicesRequest/organization/@entityID)) 
		then 
		$provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
	      else    $provider/organizations/organization
            for $org in $orgs
	      return 
	       &lt;organization entityID="{$org/@entityID}"&gt;
		  {
		    for $cp at $pos in $org/contactPoint
		    return &lt;contactPoint position="{$pos}"/&gt; 
		  }
		&lt;/organization&gt;
	  }
	&lt;/organizations&gt;
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	{
	  for $id at $pos  in  $provider/otherID
	  return &lt;otherID position="{$pos}"/&gt; 
	}
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_facility"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_facility</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_provider_facility</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;facilities&gt;
          {
	    for $fac in $provider/facilities/facility 
	    return
	    &lt;facility entityID="{$fac/@entityID}"&gt;&lt;/facility&gt;
	  }
	&lt;/facilities&gt;
      &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_organization"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_provider_organization</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_provider_organization</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;organizations&gt;
          {
	    for $org in $provider/organizations/organization 
	    return
	    &lt;organization entityID="{$org/@entityID}"&gt;&lt;/organization&gt;
	  }
	&lt;/organizations&gt;
      &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_indices_service</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_indices_service</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) 
    else (/CSD/providerDirectory/*)
  let $provs1:=     
      for $provider in  $provs0
      return
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;facilities&gt;
	  {
	    let $facs := 
	      if (exists($careServicesRequest/facility/@entityID)) 
		then 
		$provider/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]
	      else    $provider/facilities/facility
            for $fac in $facs
	      return 
	       &lt;facility entityID="{$fac/@entityID}"&gt;
		  {
		    for $srvc at $pos in $fac/service
		    return &lt;service position="{$pos}" entityID="{$srvc/@entityID}"/&gt; 
		  }
		&lt;/facility&gt;
	  }
	&lt;/facilities&gt;
    &lt;/provider&gt;
      
    return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/address/@type)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      &lt;demographic&gt;
	{(
	  for $address in $provider/demographic/address[@type = $careServicesRequest/address/@type]
	  return $address
	 )}
      &lt;/demographic&gt;
      {$provider/record}
    &lt;/provider&gt;
  else ()        
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/contactPoint/@position)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      {
	if (exists($careServicesRequest/contactPoint) and exists($careServicesRequest/contactPoint/@position)) 
	  then 
	  &lt;demographic&gt;
	    {
	      for $cp in $provider/demographic/contactPoint[position() = $careServicesRequest/contactPoint/@position]
	      return       &lt;contactPoint position="{$careServicesRequest/contactPoint/@position}"&gt;{$cp/*}&lt;/contactPoint&gt;
	  }
	  &lt;/demographic&gt;
	else
	  ()
      }
      {$provider/record}
    &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/credential/codedType/@code) and exists($careServicesRequest/credential/codedType/@codingScheme) ) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    let $code:= $careServicesRequest/credential/codedType/@code
    let $codingScheme:= $careServicesRequest/credential/codedType/@codingScheme
    return 
      &lt;provider entityID="{$provider/@entityID}"&gt;
	  {
	    (
	      $provider/credential/codedType[@code = $code and @codingScheme = $codingScheme]/..
	      ,
	      $provider/record
	    )
	  }
      &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_name"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_name</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_name</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/name/@position)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      {
	if (exists($careServicesRequest/name) and exists($careServicesRequest/name/@position)) 
	  then 
	  &lt;demographic&gt;
	    {
	      for $name in $provider/demographic/name[position() = $careServicesRequest/name/@position]
	      return       &lt;name position="{$careServicesRequest/name/@position}"&gt;{$name/*}&lt;/name&gt;
	  }
	  &lt;/demographic&gt;
	else
	  ()
      }
      {$provider/record}
    &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $provs0 := if (exists($careServicesRequest/facility/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/facility/service/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/facility/service/operatingHours/@position)) then $provs1  else ()
let $provs3 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs2,$careServicesRequest/id) else ()
let $srvc := $provs3[1]/facilities/facility[upper-case(@entityID) =upper-case($careServicesRequest/facility/@entityID)]/service[position() = $careServicesRequest/facility/service/@position]
let  $provs4:=   
  if (count($srvc) = 1) 
    then
    let $oh := $srvc/operatingHours[position() = $careServicesRequest/facility/service/operatingHours/@position]
    return &lt;provider entityID="{$careServicesRequest/id/@entityID}"&gt;
      &lt;facilities&gt;
	&lt;facility entityID="{$careServicesRequest/facility/@entityID}"&gt;
	  &lt;service position="{$careServicesRequest/facility/service/@position}" &gt;
	    &lt;operatingHours position="{$careServicesRequest/facility/service/operatingHours/@position}"&gt;{$oh/*}&lt;/operatingHours&gt;
	  &lt;/service&gt;
	&lt;/facility&gt;
      &lt;/facilities&gt;
      {$careServicesRequest}
    &lt;/provider&gt;
  else ()


return csd_bl:wrap_providers($provs4)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_org_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/organization/@entityID) and exists($careServicesRequest/organization/address/@type)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      &lt;organizations&gt;
	&lt;organization entityID="{$careServicesRequest/organization/@entityID}"&gt;
	  {
	    $provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]/address[@type = $careServicesRequest/organization/address/@type]
	  }
	&lt;/organization&gt;
      &lt;/organizations&gt;
      {$provider/record}
    &lt;/provider&gt;
  else ()        
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_org_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_org_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/organization/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/organization/contactPoint/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs1,$careServicesRequest/id) else ()
let $provs3 := 
  if (count($provs2) = 1) 
    then 
    let $provider :=  $provs2[1] 
    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      {
	if (exists($careServicesRequest/organization/@entityID) and exists($careServicesRequest/organization/contactPoint/@position)) 
	  then 
	  &lt;organizations&gt;
	    &lt;organization entityID="{$careServicesRequest/organization/@entityID}"&gt;
	    {
	      for $cp in $provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]/contactPoint[position() = $careServicesRequest/organization/contactPoint/@position]
	      return       &lt;contactPoint position="{$careServicesRequest/organization/contactPoint/@position}"&gt;{$cp/*}&lt;/contactPoint&gt;
	  }
	    &lt;/organization&gt;
	  &lt;/organizations&gt;
	else
	  ()
      }
      {$provider/record}
    &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs3)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/otherID/@position)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      {(
	if (exists($careServicesRequest/otherID/@position))
	  then 
	  for $id in $provider/otherID[position() = $careServicesRequest/otherID/@position]
	  return       
	  &lt;otherID 
	  position="{$careServicesRequest/otherID/@position}"
	  code="{$id/@code}"
	  assigningAuthorityName="{$id/@assigningAuthorityName}"&gt;{string($id)}&lt;/otherID&gt;
	else
	  ()
        ,      
	$provider/record
	)}
    &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_otherids</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/otherID/@position)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()

let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    let $other_ids := 
      if ($careServicesRequest/code/text())
      then $provider/otherID[@code = $careServicesRequest/code/text()]
      else $provider/otherID

    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      {(
	$other_ids
        ,      
	$provider/record
	)}
    &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids_json"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        application/json<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_otherids_json</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_otherids_json</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;




(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id( /CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provider :=  $provs1[1] 
let $other_ids := 
  if ($careServicesRequest/code/text())
  then $provider/otherID[@code = $careServicesRequest/code/text()]
  else $provider/otherID
let $xml:= 
  &lt;json  type="object"&gt;
    &lt;entityID&gt;{string($provider/@entityID)}&lt;/entityID&gt;
    &lt;otherID type="array"&gt;
      {
	for $id in $other_ids 
	return       
	  &lt;_ type='object'&gt;
	    &lt;code&gt;{string($id/@code)}&lt;/code&gt;
	    &lt;authority&gt;{string($id/@assigningAuthorityName)}&lt;/authority&gt;
	    &lt;value&gt;{$id/text()}&lt;/value&gt;
	 &lt;/_&gt;
      }
    &lt;/otherID&gt;
  &lt;/json&gt;
return json:serialize($xml,map{"format":"direct"})  
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_provider</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $provs0 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()  
let $provs1 :=  if (count($provs0) = 1) then
  let $prov := $provs0[1]
  return 
  &lt;provider entityID="{$prov/@entityID}"&gt;  
  {(
      $prov/codedType,
      &lt;demographic&gt;
      {(
	if (exists($prov/demographic/gender)) then $prov/demographic/gender else (),
	if (exists($prov/demographic/dateOfBirth)) then $prov/demographic/dateOfBirth else ()
      )}
      &lt;/demographic&gt;,
      $prov/language,
      $prov/specialty,
      $prov/record
  )}
  &lt;/provider&gt;
  else ()
  return csd_bl:wrap_providers($provs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_facility"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_facility</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_provider_facility</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/facility/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    return 
      &lt;provider entityID="{$provider/@entityID}"&gt;
	  {
	    (
	    &lt;facilities&gt;
	      {
		for $fac in $provider/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)  ]
		return
		&lt;facility entityID="{$fac/@entityID}"&gt;&lt;/facility&gt;
	      }
	    &lt;/facilities&gt;
	       
	      ,
	      $provider/record
	    )
	  }
      &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_organization"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_provider_organization</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_provider_organization</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/organization/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $provs2 := 
  if (count($provs1) = 1) 
    then 
    let $provider :=  $provs1[1] 
    return 
      &lt;provider entityID="{$provider/@entityID}"&gt;
	  {
	    (
	    &lt;organizations&gt;
	      {
		for $org in $provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID ) ]
		return
		&lt;organization entityID="{$org/@entityID}"&gt;&lt;/organization&gt;
	      }
	    &lt;/organizations&gt;
	       
	      ,
	      $provider/record
	    )
	  }
      &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_service"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_read_service</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_read_service</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/facility/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/facility/service/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs1,$careServicesRequest/id) else ()
let $provs3 := 
  if (count($provs2) = 1) 
    then 
    let $provider :=  $provs2[1] 
    return 
    &lt;provider entityID="{$provider/@entityID}"&gt;
      {
	if (exists($careServicesRequest/facility/@entityID) and exists($careServicesRequest/facility/service/@position)) 
	  then 
	  &lt;facilities&gt;
	    &lt;facility entityID="{$careServicesRequest/facility/@entityID}"&gt;
	    {
	      for $srvc in $provider/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]/service[position() = $careServicesRequest/facility/service/@position]
	      return       &lt;service position="{$careServicesRequest/facility/service/@position}" entityID="{$srvc/@entityID}"&gt;{$srvc/*}&lt;/service&gt;
	  }
	    &lt;/facility&gt;
	  &lt;/facilities&gt;
	else
	  ()
      }
      {$provider/record}
    &lt;/provider&gt;
  else ()    
    
return csd_bl:wrap_providers($provs3)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_urn_search_by_id"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_urn_search_by_id</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_urn_search_by_id</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $provs0 := if (exists($careServicesRequest/otherID)) then csd_bl:filter_by_other_id(/CSD/providerDirectory/*,$careServicesRequest/otherID) else ()
  let $provs1 := if (exists($careServicesRequest/start) and exists($careServicesRequest/max)) then csd_bl:limit_items($provs0,$careServicesRequest/start,$careServicesRequest/max) else $provs0
  let $provs2:= for $entityID in $provs1/@entityID     
   return &lt;provider entityID="{$entityID}"/&gt;

  return csd_bl:wrap_providers($provs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_get_urns"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_get_urns</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_get_urns</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $orgs0 := if (exists($careServicesRequest/id)) then csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) else /CSD/organizationDirectory/*
  let $orgs1 := if (exists($careServicesRequest/otherID)) then csd_bl:filter_by_other_id($orgs0,$careServicesRequest/otherID) else $orgs0
  let $orgs2 := if (exists($careServicesRequest/codedType)) then csd_bl:filter_by_coded_type($orgs1,$careServicesRequest/codedType)    else $orgs1
  let $orgs3 := if (exists($careServicesRequest/address/addressLine)) then csd_bl:filter_by_address($orgs2, $careServicesRequest/address/addressLine) else $orgs2
  let $orgs4 := if (exists($careServicesRequest/record)) then csd_bl:filter_by_record($orgs3,$careServicesRequest/record) else $orgs3
  let $orgs5 := if (exists($careServicesRequest/start) and exists($careServicesRequest/max)) then csd_bl:limit_items($orgs4,$careServicesRequest/start,$careServicesRequest/max) else $orgs4
  let $orgs6 := for $entityID in $orgs5/@entityID         
   return &lt;organization entityID="{$entityID}"/&gt;

  return csd_bl:wrap_organizations(($orgs6))
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_indices_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $orgs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) 
    else (/CSD/organizationDirectory/*)
  let $orgs1:=     
      for $organization in  $orgs0
      return
      &lt;organization entityID="{$organization/@entityID}"&gt;
	  {
	    for $address in  $organization/address
	    return &lt;address type="{$address/@type}"/&gt; 
	  }
      &lt;/organization&gt;
      
    return csd_bl:wrap_organizations($orgs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_indices_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $orgs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) 
    else (/CSD/organizationDirectory/*)
  let $orgs1:=     
      for $organization in  $orgs0
      return
      &lt;organization entityID="{$organization/@entityID}"&gt;
	  {
	    for $cp at $pos  in  $organization/contactPoint
	    return &lt;contactPoint position="{$pos}"/&gt; 
	  }
    &lt;/organization&gt;
      
    return csd_bl:wrap_organizations($orgs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_indices_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $orgs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) 
    else (/CSD/organizationDirectory/*)
  let $orgs1:=     
      for $organization in  $orgs0
      return
      &lt;organization entityID="{$organization/@entityID}"&gt;
        {
	  for $cred in $organization/credential
	  return
	  &lt;credential &gt;{$cred/codedType}&lt;/credential&gt;
	}
      &lt;/organization&gt;
      
    return csd_bl:wrap_organizations($orgs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_indices_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_indices_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $orgs0 := 
    if (exists($careServicesRequest/id/@entityID)) then 
      csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) 
    else (/CSD/organizationDirectory/*)
  let $orgs1:=     
      for $organization in  $orgs0
      return
      &lt;organization entityID="{$organization/@entityID}"&gt;
	{
	  for $id at $pos  in  $organization/otherID
	  return &lt;otherID position="{$pos}"/&gt; 
	}
    &lt;/organization&gt;
      
    return csd_bl:wrap_organizations($orgs1)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_name_search"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_name_search</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source"> 
    
    Performs a search for all organizations by name, coded type, address or ID.   
    
    
      The result set consists of the primary name of all organizations matching the  search parameters ( id, primaryName, name, codedType and address ).
     
        
      The results set may be further restricted according to the limit parameters (start, max, record/@status and record/@updated).  An ordering of the result set is not specified.
    
    
    Response
    Results are returned as a valid CSD document with a root document element of &lt;CSD/&gt;.  The results set is contained entirely within the &lt;organizationDirectory/&gt; element and consists of the full content of the &lt;organization/&gt; elements of matching organizations as maintained by the Care Services InfoManager.
    
    Parameters Query
    Parameters are defined as the content of following elements:
    
       &lt;id/&gt; csd:uniqueID: (optional) If present and the @urn attribute contains a non-empty value, it is a ID which uniquely identifies an organization. This is an exact match.  
      
      &lt;primaryName/&gt; xs:string: (optional) If present and contains a non-empty value, then the result set should be restricted to those organizations whose &lt;primaryName/&gt; contains this value. Case insensitive.
      &lt;name/&gt; xs:string: (optional) If present and contains a non-empty value, then the result set should be restricted to those organizations which have a &lt;primaryName/&gt; or &lt;otherName/&gt; element containing this value. Case insensitive.      
      &lt;codedType/&gt; csd:codedtype:  If present and contains a non-empty value the result set should be restricted to those organizations whose &lt;codedType/@code&gt; equals this value for the coding schema specified by the @codingSchema attribute.  Case insensitive.
      
       &lt;address/&gt; csd:address: (optional) Contains of any-number of child &lt;addressLine/&gt; elements as follows:
        
          Text content xs:string: (optional) If present and contains a non-empty value, then the results set should be restricted to those organizations whose have an &lt;addressLine/&gt; with specified @component containing this value exactly.  Case insensitive.
           
          @component xs:string : (Required attribute) The component of the address we are searching. Case insensitive.
          
      
      &lt;start/&gt;  xs:int: (optional) The starting index for results returned. Defaults to 1, which indexes the first organization matching the search parameters
      &lt;max/&gt;  xs:int: (optional) The maximum number of results returned.  A value of less than zero implies no maximum.
      
	&lt;record/&gt;  csd:record : (optional) A child element to limit results according to
	
	  @status xs:string: (optional) If present and contains a non-empty value, the result set should be restricted to those organizations whose record/@status equals this value.  Case insensitive.
	  @updated xs:dateTime: (optional) If present and contains a non-empty value, the result set should be restricted to those organizations whose record/@updated is at least the given value.
	
      
    
    Example Request
    
         &lt;careServicesRequest&gt;
           &lt;function uuid='dc6aedf0-f609-11e2-b778-0800200c9a66'&gt;
               &lt;codedType codingSchema="moh.gov.rw" code="FBO" /&gt;
               &lt;address&gt;
                 &lt;addressLine component='city'&gt;Kigali&lt;/addressLine&gt;
	       &lt;/address&gt;
               &lt;max&gt;5&lt;/max&gt;
           &lt;/function&gt;
         &lt;/careServicesRequest&gt;         
      
  </span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
    
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 


&lt;CSD xmlns:csd="urn:ihe:iti:csd:2013"  &gt;
  &lt;organizationDirectory&gt;
    {
      let $orgs0 := if (exists($careServicesRequest/id))
	then csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id)
      else /CSD/organizationDirectory/*
         
      let $orgs1 := if (exists($careServicesRequest/primaryName))
	then csd_bl:filter_by_primary_name($orgs0,$careServicesRequest/primaryName)
      else $orgs0
         
      let $orgs2 := if(exists($careServicesRequest/name))
	then csd_bl:filter_by_name($orgs1,$careServicesRequest/name)
      else $orgs1
    
      let $orgs3 := if(exists($careServicesRequest/codedType))
	then csd_bl:filter_by_coded_type($orgs2,$careServicesRequest/codedType)
      else $orgs2
   
      let $orgs4 :=if (exists($careServicesRequest/address/addressLine))
	then csd_bl:filter_by_address($orgs3, $careServicesRequest/address/addressLine)
      else $orgs3
      
      let $orgs5 := if (exists($careServicesRequest/record))
	then csd_bl:filter_by_record($orgs4,$careServicesRequest/record)
      else $orgs4

      let $orgs6 := if (exists($careServicesRequest/otherID))
	then csd_bl:filter_by_other_id($orgs5,$careServicesRequest/otherID)
      else $orgs5

      let $orgs7 := if (exists($careServicesRequest/start)) then
	if (exists($careServicesRequest/max))
	  then csd_bl:limit_items($orgs6,$careServicesRequest/start,$careServicesRequest/max)
	else csd_bl:limit_items($orgs6,$careServicesRequest/start,&lt;max/&gt;)
      else
	if (exists($careServicesRequest/max))
	  then csd_bl:limit_items($orgs6,&lt;start/&gt;,$careServicesRequest/max)
	else $orgs6
	  
      return for $org in $orgs7
	return&lt;organization urn='{$org/@urn}'&gt;
	  {$org/primaryName}
	&lt;/organization&gt;

    }     
  &lt;/organizationDirectory&gt;
  &lt;serviceDirectory/&gt;
  &lt;facilityDirectory/&gt;
  &lt;providerDirectory/&gt;
&lt;/CSD&gt;
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_read_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_read_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facilty_read_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $orgs0 := if (exists($careServicesRequest/address/@type)) then /CSD/organizationDirectory/*  else ()
let $orgs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($orgs0,$careServicesRequest/id) else ()
let $orgs2 := 
  if (count($orgs1) = 1) 
    then 
    let $organization :=  $orgs1[1] 
    return 
    &lt;organization entityID="{$organization/@entityID}"&gt;
	{(
	  for $address in $organization/address[@type = $careServicesRequest/address/@type]
	  return $address
	 )}
      {$organization/record}
    &lt;/organization&gt;
  else ()        
return csd_bl:wrap_organizations($orgs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_read_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_read_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_read_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $orgs0 := if (exists($careServicesRequest/contactPoint/@position)) then /CSD/organizationDirectory/*  else ()
let $orgs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($orgs0,$careServicesRequest/id) else ()
let $orgs2 := 
  if (count($orgs1) = 1) 
    then 
    let $organization :=  $orgs1[1] 
    return 
    &lt;organization entityID="{$organization/@entityID}"&gt;
      {
	if (exists($careServicesRequest/contactPoint) and exists($careServicesRequest/contactPoint/@position)) 
	  then 
	      for $cp in $organization/contactPoint[position() = $careServicesRequest/contactPoint/@position]
	      return       &lt;contactPoint position="{$careServicesRequest/contactPoint/@position}"&gt;{$cp/*}&lt;/contactPoint&gt;
	else
	  ()
      }
      {$organization/record}
    &lt;/organization&gt;
  else ()    
    
return csd_bl:wrap_organizations($orgs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_read_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_read_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_read_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $orgs0 := if (exists($careServicesRequest/credential/codedType/@code) and exists($careServicesRequest/credential/codedType/@codingScheme) ) then /CSD/organizationDirectory/*  else ()
let $orgs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($orgs0,$careServicesRequest/id) else ()
let $orgs2 := 
  if (count($orgs1) = 1) 
    then 
    let $organization :=  $orgs1[1] 
    let $code:= $careServicesRequest/credential/codedType/@code
    let $codingScheme:= $careServicesRequest/credential/codedType/@codingScheme
    return 
      &lt;organization entityID="{$organization/@entityID}"&gt;
	  {
	    (
	      $organization/credential/codedType[@code = $code and @codingScheme = $codingScheme]/..
	      ,
	      $organization/record
	    )
	  }
      &lt;/organization&gt;
  else ()    
    
return csd_bl:wrap_organizations($orgs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_read_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_read_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_read_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $orgs0 := if (exists($careServicesRequest/otherID/@position)) then /CSD/organizationDirectory/*  else ()
let $orgs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($orgs0,$careServicesRequest/id) else ()
let $orgs2 := 
  if (count($orgs1) = 1) 
    then 
    let $organization :=  $orgs1[1] 
    return 
    &lt;organization entityID="{$organization/@entityID}"&gt;
      {(
	if (exists($careServicesRequest/otherID/@position))
	  then 
	  for $id in $organization/otherID[position() = $careServicesRequest/otherID/@position]
	  return       
	  &lt;otherID 
	  position="{$careServicesRequest/otherID/@position}"
	  code="{$id/@code}"
	  assigningAuthorityName="{$id/@assigningAuthorityName}"&gt;{string($id)}&lt;/otherID&gt;
	else
	  ()
        ,      
	$organization/record
	)}
    &lt;/organization&gt;
  else ()    
    
return csd_bl:wrap_organizations($orgs2)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:provider_name_search"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:provider_name_search</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">
     Performs a search for all providers by name, coded type, address or ID. 
     The result set consists of all names  providers matching the search parameters ( id,
        otherID, commonName,codedType and address ). 
     The results set may be further restricted according to the limit parameters
        (start, max, record/@status and record/@updated). An ordering of
      the result set is not specified. 
    
      Response Results are returned as a valid CSD document with a root document element of
      &lt;CSD/&gt;. The results set is contained entirely within the &lt;providerDirectory/&gt;
      element and consists of the full content of the &lt;provider/&gt; elements of matching
      providers as maintained by the Care Services InfoManager. 
    Parameters Query Parameters are defined as the content of following elements: 
       &lt;id/&gt; csd:uniqueID: (optional) If present and the @urn attribute contains a
        non-empty value, it is a ID which uniquely identifies a provider. This is an exact match. 
       &lt;otherID/&gt; csd:otherID: (optional) If present and the
        @assigningAuthorityName attribute contains a non-empty value, then the result set is
        restricted to only those providers which have a &lt;otherID/&gt; with the given
        assigingAuthorityName and @code  &lt;commonName/&gt; xsd:string: (optional)
        If present and contains a non-empty value, then the result set should be restricted to those
        providers which have a &lt;demographic/name/commonName/&gt; containing this value. Case
        insensitive.
      &lt;codedType/&gt; csd:codedtype: If present and contains a non-empty value the
        result set should be restricted to those providers whose &lt;codeType/@code&gt; equals this
        value for the coding schema specified by the @codingSchema attribute. Case insensitive. 
       &lt;address/&gt; csd:address: (optional) Contains of any-number of child
        &lt;addressLine/&gt; elements as follows: 
          Text content xsd:string: (optional) If present and contains a non-empty value,
            then the results set should be restricted to those providers whose have an
            &lt;addressLine/&gt; with specified @component containing this value exactly. Case
            insensitive. 
          @component xsd:string : (Required attribute) The component of the address we
            are searching. Case insensitive.
        
      
      &lt;start/&gt;  xsd:int: (optional) The starting index for results returned.
        Defaults to 1, which indexes the first provider matching the search parameters
      &lt;max/&gt;  xsd:int: (optional) The maximum number of results returned. A value
        of less than zero implies no maximum.
       &lt;record/&gt;  csd:record : (optional) A child element to limit results
        according to 
          @status xsd:string: (optional) If present and contains a non-empty value, the
            result set should be restricted to those providers whose record/@status equals this
            value. Case insensitive.
          @updated xsd:dateTime: (optional) If present and contains a non-empty value,
            the result set should be restricted to those providers whose record/@updated is at least
            the given value.
        
      
    
    Example Request
    
         &lt;careServicesRequest&gt;
           &lt;function uuid='4e8bbeb9-f5f5-11e2-b778-0800200c9a66'&gt;
               &lt;codedType code="2221" codingSchema="ISCO-08" /&lt;
               &lt;address&gt;
                 &lt;addressLine component='city'&gt;Kigali&lt;/addressLine&gt;
	       &lt;/address&gt;
               &lt;max&gt;5&lt;/max&gt;
           &lt;/function&gt;
         &lt;/careServicesRequest&gt;         
      
  </span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
    
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

&lt;CSD xmlns:csd="urn:ihe:iti:csd:2013"  &gt;
  &lt;organizationDirectory/&gt;
  &lt;serviceDirectory/&gt;
  &lt;facilityDirectory/&gt;
  &lt;providerDirectory&gt;
    {

      let $provs0 := if (exists($careServicesRequest/id))
	then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id)
      else /CSD/providerDirectory/*

      let $provs1 := if(exists($careServicesRequest/otherID))
	then csd_bl:filter_by_other_id($provs0,$careServicesRequest/otherID)
      else $provs0
         
      let $provs2 := if(exists($careServicesRequest/commonName))
	then csd_bl:filter_by_common_name($provs1,$careServicesRequest/commonName)
      else $provs1
    
      let $provs3 := if (exists($careServicesRequest/codedType))
	then csd_bl:filter_by_coded_type($provs2,$careServicesRequest/codedType) 
      else $provs2
   
      let $provs4 := if (exists($careServicesRequest/address/addressLine))
	then csd_bl:filter_by_demographic_address($provs3, $careServicesRequest/address/addressLine) 
      else $provs3

      let $provs5 :=  if (exists($careServicesRequest/record)) 
	then csd_bl:filter_by_record($provs4,$careServicesRequest/record)      
      else  $provs4

      let $provs6:= if (exists($careServicesRequest/start)) then
	if (exists($careServicesRequest/max)) 
	  then csd_bl:limit_items($provs5,$careServicesRequest/start,$careServicesRequest/max)         
	else csd_bl:limit_items($provs5,$careServicesRequest/start,&lt;max/&gt;)         
      else
	if (exists($careServicesRequest/max)) 
	  then csd_bl:limit_items($provs5,&lt;start/&gt;,$careServicesRequest/max)         
	else $provs5

     return 
       for $prov in $provs6
	 return 
	 &lt;provider entityID='{$prov/@entityID}'&gt;
	   &lt;demogrpahic&gt;
	   {$prov/demographic/name}
	   &lt;/demogrpahic&gt;
	 &lt;/provider&gt;

    }     
  &lt;/providerDirectory&gt;
&lt;/CSD&gt;
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:service_get_urns"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:service_get_urns</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">service_get_urns</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  let $srvcs0 := if (exists($careServicesRequest/id)) then csd_bl:filter_by_primary_id(/CSD/serviceDirectory/*,$careServicesRequest/id) else /CSD/serviceDirectory/*
  let $srvcs1 := if (exists($careServicesRequest/codedType)) then csd_bl:filter_by_coded_type($srvcs0,$careServicesRequest/codedType)    else $srvcs0
  let $srvcs2 := if (exists($careServicesRequest/record)) then csd_bl:filter_by_record($srvcs1,$careServicesRequest/record) else $srvcs1
  let $srvcs3 := if (exists($careServicesRequest/start) and exists($careServicesRequest/max)) then csd_bl:limit_items($srvcs2,$careServicesRequest/start,$careServicesRequest/max) else $srvcs2
  let $srvcs4 := for $entityID in $srvcs3/@entityID         
   return &lt;service entityID="{$entityID}"/&gt;

  return csd_bl:wrap_services(($srvcs4))
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_create_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/address/@type))  then $fac1 else ()
return  
  if ( count($fac2) = 1 )
    then
    let $facility:= $fac2[1]
    return
      let $fac3:=  
      &lt;facility entityID="{$facility/@entityID}"&gt;
        &lt;address type="{$careServicesRequest/address/@type}"/&gt;
      &lt;/facility&gt;
       return (
	   insert node
	   $careServicesRequest/address
	   into $facility
	   ,
	csd_blu:wrap_updating_facilities($fac3)
	)
  else  csd_blu:wrap_updating_facilities(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_create_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_create_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_create_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/contactPoint))  then $fac1 else ()
return  
  if ( count($fac2) = 1 )
    then
    let $facility:= $fac2[1]
    let $position := count($facility/contactPoint) +1
    let $cp := 
      &lt;contactPoint&gt;
	{(
	  if (exists($careServicesRequest/contactPoint/codedType)) then  $careServicesRequest/contactPoint/codedType else (),
	  if (exists($careServicesRequest/contactPoint/equipment)) then  $careServicesRequest/contactPoint/equipment else (),
	  if (exists($careServicesRequest/contactPoint/purpose)) then  $careServicesRequest/contactPoint/purpose else (),
	  if (exists($careServicesRequest/contactPoint/certificate)) then  $careServicesRequest/contactPoint/certificate else ()
	 )}
      &lt;/contactPoint&gt;
    let $fac3:=  
    &lt;facility entityID="{$facility/@entityID}"&gt;
	&lt;contactPoint position="{$position}"/&gt;
    &lt;/facility&gt;
    return 
      (insert node $cp into $facility ,    
      csd_blu:wrap_updating_facilities($fac3)
      )
  else  csd_blu:wrap_updating_facilities(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_create_geocode"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_create_geocode</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_create_geocode</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/geocode) and count($fac1/geocode) = 0)  then $fac1 else ()
return  
  if ( count($fac2) = 1 )
    then
    let $facility:= $fac2[1]
    return
      let $fac3:=  
      &lt;facility entityID="{$facility/@entityID}"&gt;
        &lt;geocode/&gt;
      &lt;/facility&gt;
       return (
	   insert node
	   $careServicesRequest/geocode
	   into $facility
	   ,
	csd_blu:wrap_updating_facilities($fac3)
	)
  else  csd_blu:wrap_updating_facilities(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_create_language"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_create_language</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_create_language</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/language/@code) and exists($careServicesRequest/language/@codingScheme))  then $fac1 else ()
let $lang0 := $fac2/language[@code = $careServicesRequest/language/@code and @codingScheme = $fac2/language/@codingScheme] 
return  
  if ( count($fac2) = 1 and count($lang0) = 0)
    then
    let $facility:= $fac2[1]
    return
      let $fac3:=  
      &lt;facility entityID="{$facility/@entityID}"&gt;
        &lt;language code="{$careServicesRequest/language/@code}" codingScheme="{$careServicesRequest/language/@codingScheme}"/&gt;
      &lt;/facility&gt;
       return (
	   insert node
	   $careServicesRequest/language
	   into $facility
	   ,
	csd_blu:wrap_updating_facilities($fac3)
	)
  else  csd_blu:wrap_updating_facilities(())</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_create_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_create_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_create_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/operatingHours))  then $fac1 else ()
return  
  if ( count($fac2) = 1 )
    then
    let $facility:= $fac2[1]
    return
      let $fac3:=  
      &lt;facility entityID="{$facility/@entityID}"&gt;
        &lt;operatingHours/&gt;
      &lt;/facility&gt;
       return (
	   insert node
	   $careServicesRequest/operatingHours
	   into $facility
	   ,
	csd_blu:wrap_updating_facilities($fac3)
	)
  else  csd_blu:wrap_updating_facilities(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_create_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_create_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_create_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/otherID/@code))  then $fac1 else ()
return  
  if ( count($fac2) = 1 )
    then
    let $facility:= $fac2[1]
    let $position := count($facility/otherID) +1
    let $id := 
      if (exists($careServicesRequest/otherID/@assigningAuthorityName)) then
      &lt;otherID code="{$careServicesRequest/otherID/@code}" assigningAuthorityName="{$careServicesRequest/otherID/@assigningAuthorityName}"&gt;{string($careServicesRequest/otherID)}&lt;/otherID&gt;
    else 
      &lt;otherID code="{$careServicesRequest/otherID/@code}"&gt;{string($careServicesRequest/otherID)}&lt;/otherID&gt;
    let $fac3:=  
    &lt;facility entityID="{$facility/@entityID}"&gt;
      &lt;otherID position="{$position}"/&gt;
    &lt;/facility&gt;
    return 
      (insert node $id into $facility ,    
      csd_blu:wrap_updating_facilities($fac3)
      )
  else  csd_blu:wrap_updating_facilities(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_delete_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/address/@type))  then $fac1 else ()
let $address:= $fac2[1]/address[@type = $careServicesRequest/address/@type]
return 
let $fac:=  
      &lt;facility entityID="{$fac2/@entityID}"&gt;
        &lt;address type="{$careServicesRequest/address/@type}"/&gt;
      &lt;/facility&gt;
       return (
	   if (exists($address)) then (delete node $address) else ()
	   ,
	csd_blu:wrap_updating_facilities($fac)
	)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_delete_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/contactPoint/@position)) 
    then 
    let $facilities := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($facilities) = 1 )
	then
	let  $cp :=  $facilities[1]/contactPoint[position() = $careServicesRequest/contactPoint/@position]
	return if (exists($cp)) then (delete node $cp) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_geocode"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_geocode</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_delete_geocode</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/geocode))  then $fac1 else ()
let $geocode:= $fac2[1]/geocode
return 
let $fac:=  
      &lt;facility entityID="{$fac2/@entityID}"&gt;
        &lt;geocode/&gt;
      &lt;/facility&gt;
       return (
	   if (exists($geocode)) then (delete node $geocode) else ()
	   ,
	csd_blu:wrap_updating_facilities($fac)
	)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_language"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_language</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_delete_language</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/language/@code))  then $fac1 else ()
let $language:= $fac2[1]/language[@code = $careServicesRequest/language/@code]
return 
let $fac:=  
      &lt;facility entityID="{$fac2/@entityID}"&gt;
        &lt;language code="{$careServicesRequest/language/@code}"/&gt;
      &lt;/facility&gt;
       return (
	   if (exists($language)) then (delete node $language) else ()
	   ,
	csd_blu:wrap_updating_facilities($fac)
	)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_name"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_name</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_delete_name</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/primaryName/@position)) 
    then 
    let $facilities := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($facilities) = 1 )
	then
	let  $name :=  $facilities[1]/primaryName[position() = $careServicesRequest/primaryName/@position]
	return if (exists($name)) then (delete node $name) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_delete_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $fac0 := if (exists($careServicesRequest/organization/@entityID)) then /CSD/facilityDirectory/*  else ()
let $fac1 := if (exists($careServicesRequest/organization/service/@position)) then $fac0  else ()
let $fac2 := if (exists($careServicesRequest/organization/service/operatingHours/@position)) then $fac1  else ()
let $fac3 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($fac2,$careServicesRequest/id) else ()
let $oh := $fac3[1]/organizations/organization[upper-case(@entityID) =upper-case($careServicesRequest/organization/@entityID)]/service[position() = $careServicesRequest/organization/service/@position]/operatingHours[position() = $careServicesRequest/organization/service/operatingHours/@position]
return
  if (count($oh) = 1)
    then (delete node $oh) else ()
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_delete_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_delete_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu" ;
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/otherID/@position)) 
    then 
    let $facilities := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($facilities) = 1 )
	then
	let  $id :=  $facilities[1]/otherID[position() = $careServicesRequest/otherID/@position]
	return if (exists($id)) then (delete node $id) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_update_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_update_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_update_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/address/@type))  then $fac1 else ()
let $facility:= $fac2[1]
let $address:= $facility/address[@type = $careServicesRequest/address/@type]
return  
  if ( not(exists($address))) then
    csd_blu:wrap_updating_facilities(()) (: Address does not exist.  Do not update:)
  else
    let $fac3:=  
    &lt;facility entityID="{$facility/@entityID}"&gt;
      &lt;address type="{$careServicesRequest/address/@type}"/&gt;
    &lt;/facility&gt;
    return (
      csd_blu:bump_timestamp($facility),
      replace  node  $address with $careServicesRequest/address
      ,
      csd_blu:wrap_updating_facilities($fac3)
    )
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_update_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_update_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_update_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $fac0 := if (exists($careServicesRequest/contactPoint/@position)) then /CSD/facilityDirectory/*  else ()
let $fac1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($fac0,$careServicesRequest/id) else ()
let $old_cp := $fac1[1]/contactPoint[position() = $careServicesRequest/contactPoint/@position]
return
  if (count($fac1) = 1 and exists($old_cp)) 
    then
    let $new_cp := $careServicesRequest/contactPoint
    let $fac2 := 
    &lt;facility entityID="{$fac1[1]/@entityID}"&gt;
	  &lt;contactPoint position="{$careServicesRequest/contactPoint/@position}"/&gt;
    &lt;/facility&gt;
    return
      (
	csd_blu:bump_timestamp($fac1[1]),
	if (exists($new_cp/codedType)) then (delete node $old_cp/codedType,insert node $new_cp/codedType into $old_cp) else (),
	if (exists($new_cp/equipment)) then (delete node $old_cp/equipment,insert node $new_cp/equipment into $old_cp) else (),
	if (exists($new_cp/purpose)) then (delete node $old_cp/purpose,insert node $new_cp/purpose into $old_cp) else (),
	if (exists($new_cp/certificate)) then (delete node $old_cp/certificate,insert node $new_cp/certificate into $old_cp) else (),
	csd_blu:wrap_updating_facilities($fac2)
     )
  else 	csd_blu:wrap_updating_facilities(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_update_name"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_update_name</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_update_name</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $fac0 := if (exists($careServicesRequest/primaryName/@position)) then /CSD/facilityDirectory/*  else ()
let $fac1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($fac0,$careServicesRequest/id) else ()
let $name := $fac1[1]/primaryName[position() = $careServicesRequest/primaryName/@position]
return
  if (count($fac1) = 1 and exists($name)) 
    then
    let $fac2 := 
    &lt;facility entityID="{$fac1[1]/@entityID}"&gt;
	  &lt;name position="{$careServicesRequest/primaryName/@position}"/&gt;
    &lt;/facility&gt;
    let $new_name := $careServicesRequest/primaryName
    return
      (
	csd_blu:bump_timestamp($fac1[1]),
	replace  node $name with $new_name,
	csd_blu:wrap_updating_facilities($fac2)
     )
  else 	csd_blu:wrap_updating_facilities(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_update_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_update_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_update_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $fac0 := if (exists($careServicesRequest/organization/@entityID)) then /CSD/facilityDirectory/*  else ()
let $fac1 := if (exists($careServicesRequest/organization/service/@position)) then $fac0  else ()
let $fac2 := if (exists($careServicesRequest/organization/service/operatingHours/@position)) then $fac1  else ()
let $fac3 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($fac2,$careServicesRequest/id) else ()
let $oh := $fac3[1]/organizations/organization[upper-case(@entityID) =upper-case($careServicesRequest/organization/@entityID)]/service[position() = $careServicesRequest/organization/service/@position]/operatingHours[position() = $careServicesRequest/organization/service/operatingHours/@position]
return
  if (count($oh) = 1 and count($fac3) = 1)
    then
    let $new_oh := $careServicesRequest/organization/service/operatingHours
    let $fac4 := 
    &lt;facility entityID="{$fac1[1]/@entityID}"&gt;
      &lt;organizations&gt;
	&lt;organization entityID="{$careServicesRequest/organization/@entityID}"&gt;
	  &lt;service position="{$careServicesRequest/organization/service/@position}" &gt;
	    &lt;operatingHours position="{$careServicesRequest/organization/service/operatingHours/@position}"/&gt;
	  &lt;/service&gt;
	&lt;/organization&gt;
      &lt;/organizations&gt;
    &lt;/facility&gt;
    return
      (
	csd_blu:bump_timestamp($fac3[1]),
	if (exists($new_oh/openFlag)) then (delete node $oh/openFlag,insert node $new_oh/openFlag into $oh) else (),
	if (exists($new_oh/dayOfTheWeek)) then (delete node $oh/dayOfTheWeek,insert node $new_oh/dayOfTheWeek into $oh) else (),
	if (exists($new_oh/beginningHour)) then (delete node $oh/beginningHour,insert node $new_oh/beginningHour into $oh) else (),
	if (exists($new_oh/endingHour)) then (delete node $oh/endingHour,insert node $new_oh/endingHour into $oh) else (),
	if (exists($new_oh/beginEffectiveDate)) then (delete node $oh/beginEffectiveDate,insert node $new_oh/beginEffectiveDate into $oh) else (),
	if (exists($new_oh/endEffectiveDate)) then (delete node $oh/endEffectiveDate,insert node $new_oh/endEffectiveDate into $oh) else (),
	csd_blu:wrap_updating_facilities($fac4)
     )
  else 	csd_blu:wrap_updating_facilities(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_update_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_update_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_update_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $fac0 := if (exists($careServicesRequest/otherID)) then /CSD/facilityDirectory/*  else ()
let $fac1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($fac0,$careServicesRequest/id) else ()
let $id := $fac1[1]/otherID[position() = $careServicesRequest/otherID/@position]
return
  if (count($fac1) = 1 and exists($id)) 
    then
    let $fac2 := 
    &lt;facility entityID="{$fac1[1]/@entityID}"&gt;
      &lt;otherID position="{$careServicesRequest/otherID/@position}"/&gt;
    &lt;/facility&gt;
    return
      (
	csd_blu:bump_timestamp($fac1[1]),
	if ($careServicesRequest/otherID/@code) 
	  then 	    
	    if (exists($id/@code))
	      then  (replace value of node $id/@code with $careServicesRequest/otherID/@code)
	      else (insert node  $careServicesRequest/otherID/@code into $id)
	  else (),
	if (exists($careServicesRequest/otherID/@assigningAuthorityName) )
	  then 
	    if (exists($id/@assigningAuthorityName))
	      then replace value of node $id/@assigningAuthorityName with $careServicesRequest/otherID/@assigningAuthorityName
	      else insert node $careServicesRequest/otherID/@assigningAuthorityName into $id		
	  else (),
	if (not(string($careServicesRequest/otherID) = '')) 
	  then (replace value of node $id with string($careServicesRequest/otherID))
	  else (),
	csd_blu:wrap_updating_facilities($fac2)
     )
  else 	csd_blu:wrap_updating_facilities(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/address/@type))  then $provs1 else ()
return  
  if ( count($provs2) = 1 )
    then
    let $provider:= $provs2[1]
    let $demo := $provider/demographic
    return if (exists($demo/address[@type = $careServicesRequest/address/@type])) 
      then
      csd_blu:wrap_updating_providers(()) (: Do not allow the same type to be created more than once:)
    else
      let $provs3:=  
      &lt;provider entityID="{$provider/@entityID}"&gt;
        &lt;demographic&gt;&lt;address type="{$careServicesRequest/address/@type}"/&gt;&lt;/demographic&gt;
      &lt;/provider&gt;
       return (
	 if (not(exists($demo)))
	   then
	   insert node
	   &lt;demographic&gt;{$careServicesRequest/address}&lt;/demographic&gt;
	   into $provider	
	 else	
	   insert node  $careServicesRequest/address into $demo
	   ,
	csd_blu:wrap_updating_providers($provs3)
	)
  else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/contactPoint))  then $provs1 else ()
return  
  if ( count($provs2) = 1 )
    then
    let $provider:= $provs2[1]
    let $position := count($provider/demographic/contactPoint) +1
    let $cp := 
      &lt;contactPoint&gt;
	{(
	  if (exists($careServicesRequest/contactPoint/codedType)) then  $careServicesRequest/contactPoint/codedType else (),
	  if (exists($careServicesRequest/contactPoint/equipment)) then  $careServicesRequest/contactPoint/equipment else (),
	  if (exists($careServicesRequest/contactPoint/purpose)) then  $careServicesRequest/contactPoint/purpose else (),
	  if (exists($careServicesRequest/contactPoint/certificate)) then  $careServicesRequest/contactPoint/certificate else ()
	 )}
      &lt;/contactPoint&gt;
    let $provs3:=  
    &lt;provider entityID="{$provider/@entityID}"&gt;
      &lt;demographic&gt;
	&lt;contactPoint position="{$position}"/&gt;
      &lt;/demographic&gt;
    &lt;/provider&gt;
    return 
      (insert node $cp into $provider/demographic ,    
      csd_blu:wrap_updating_providers($provs3)
      )
  else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/credential/codedType/@code) and exists($careServicesRequest/credential/codedType/@codingScheme) ) then $provs1  else ()
let $cred_request := $careServicesRequest/credential
let $code:= $cred_request/codedType/@code
let $codingScheme:= $cred_request/codedType/@codingScheme
let $creds0 := $provs2/credential/codedType[@code = $code and @codingScheme = $codingScheme]
return  
  if ( count($provs2) = 1 and count($creds0) = 0)  (:DO NOT ALLOW SAME CRED TWICE :)
    then
    let $provider:= $provs2[1]
    let $cred_rec :=
    &lt;credential&gt;
      &lt;codedType code="{$code}" codingScheme="{$codingScheme}"/&gt;
    &lt;/credential&gt;
    let $cred_new :=
    &lt;credential&gt;
      &lt;codedType code="{$code}" codingScheme="{$codingScheme}"/&gt;
      {(
	if (exists($cred_request/number)) then $cred_request/number else (),
	if (exists($cred_request/issuingAuthority)) then $cred_request/issuingAuthority else (),
	if (exists($cred_request/credentialIssueDate)) then $cred_request/credentialIssueDate else (),
        if (exists($cred_request/credentialRenewalDate)) then $cred_request/credentialRenewalDate else ()
      )}
    &lt;/credential&gt;
    let $provs3:=  
    &lt;provider entityID="{$provider/@entityID}"&gt;{$cred_rec}&lt;/provider&gt;
    return 
	(
	insert node $cred_new into $provider,
	csd_blu:wrap_updating_providers($provs3)
	)

  else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_name"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_name</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_name</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/name))  then $provs1 else ()
return  
  if ( count($provs2) = 1 )
    then
    let $provider:= $provs2[1]
    let $position := count($provider/demographic/name) +1
    let $provs3:=  
    &lt;provider entityID="{$provider/@entityID}"&gt;
      &lt;demographic&gt;
	&lt;name position="{$position}"/&gt;
      &lt;/demographic&gt;
    &lt;/provider&gt;
    return 
      (
	if (exists($provider/demographic))
	  then insert node $careServicesRequest/name into $provider/demographic 
	else
	  insert node &lt;demographic&gt;{$careServicesRequest/name}&lt;/demographic&gt; into $provider
	  ,   csd_blu:wrap_updating_providers($provs3)
	)
  else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/facility/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/facility/service/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/facility/service/operatingHours)) then $provs1  else ()
let $provs3 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs2,$careServicesRequest/id) else ()
let $srvc := $provs3[1]/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]/service[position() = $careServicesRequest/facility/service/@position]
return if (count($srvc) = 1) 
  then
  let $position := count($srvc/operatingHours)
  let $provs4:=  
  &lt;provider entityID="{$careServicesRequest/id/@entityID}"&gt;
    &lt;facilities&gt;
      &lt;facility entityID="{$careServicesRequest/facility/@entityID}"&gt;
	&lt;service position="{$careServicesRequest/facility/service/@position}" entityID="{$careServicesRequest/facility/service/@entityID}"&gt;
	  &lt;operatingHours position="{$position}" /&gt;
	&lt;/service&gt;
      &lt;/facility&gt;
    &lt;/facilities&gt;
  &lt;/provider&gt;
  return 
    (insert node $careServicesRequest/facility/service/operatingHours into $srvc[1] ,    
    csd_blu:wrap_updating_providers($provs4)
  )
else   csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_org_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/organization/@entityID))  then $provs1 else ()
let $provs3 := if (exists($careServicesRequest/organization/address/@type))  then $provs2 else ()
let $provider:= $provs3[1]
let $orgs := $provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
let $org := if(count($orgs) =1) then $orgs[1] else ()
let $address := $org/address[@type = $careServicesRequest/organization/address/@type]
return if (not(exists($org)) or exists($address))
  then   csd_blu:wrap_updating_providers(()) (:do not create an already existing one :)	  
else
  (
    insert node $careServicesRequest/organization/address into $org,
    csd_blu:wrap_updating_providers(    
	&lt;provider entityID="{$provider/@entityID}"&gt;
	  &lt;organizations&gt;
	    &lt;organization entityID="{$org/@entityID}"&gt;
	      &lt;contactPoint position="{$careServicesRequest/organization/address/@type}"/&gt;
	    &lt;/organization&gt;
	  &lt;/organizations&gt;
	&lt;/provider&gt;
     )
)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_org_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_org_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/organization/@entityID))  then $provs1 else ()
let $provs3 := if (exists($careServicesRequest/organization/contactPoint))  then $provs2 else ()
return  
  if ( count($provs3) = 1 )
    then
    let $provider:= $provs3[1]
    let $orgs := $provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
    return 
      if (count($orgs) = 1) 
	then
	let $org := $orgs[1]
	let $position := count($org/contactPoint) +1
	let $new_cp := $careServicesRequest/organization/contactPoint
	let $cp := 
	&lt;contactPoint&gt;
	  {(
	    if (exists($new_cp/codedType)) then  $new_cp/codedType else (),
            if (exists($new_cp/equipment)) then  $new_cp/equipment else (),
            if (exists($new_cp/purpose)) then  $new_cp/purpose else (),
            if (exists($new_cp/certificate)) then  $new_cp/certificate else ()
	   )}
	&lt;/contactPoint&gt;
	let $provs3:=  
	&lt;provider entityID="{$provider/@entityID}"&gt;
	  &lt;organizations&gt;
	    &lt;organization entityID="{$org/@entityID}"&gt;
	      &lt;contactPoint position="{$position}"/&gt;
	    &lt;/organization&gt;
	  &lt;/organizations&gt;
	&lt;/provider&gt;
	return 
	  (insert node $cp into $org ,    
	  csd_blu:wrap_updating_providers($provs3)
	)
      else   csd_blu:wrap_updating_providers(())
    else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/otherID/@code))  then $provs1 else ()
return  
  if ( count($provs2) = 1 )
    then
    let $provider:= $provs2[1]
    let $position := count($provider/otherID) +1
    let $id := 
      if (exists($careServicesRequest/otherID/@assigningAuthorityName)) then
      &lt;otherID code="{$careServicesRequest/otherID/@code}" assigningAuthorityName="{$careServicesRequest/otherID/@assigningAuthorityName}"&gt;{string($careServicesRequest/otherID)}&lt;/otherID&gt;
    else 
      &lt;otherID code="{$careServicesRequest/otherID/@code}"&gt;{string($careServicesRequest/otherID)}&lt;/otherID&gt;
    let $provs3:=  
    &lt;provider entityID="{$provider/@entityID}"&gt;
      &lt;otherID position="{$position}"/&gt;
    &lt;/provider&gt;
    return 
      (insert node $id into $provider ,    
      csd_blu:wrap_updating_providers($provs3)
      )
  else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_provider</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
(:
import module namespace random = "http://basex.org/modules/random";
:)
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $provs0 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()  
return
  if (count($provs0) &gt; 0) then (csd_blu:wrap_updating_providers(()))     (:do not allow duplicate ENTITYIDs:)
else
  let $entityID := 
    if (exists($careServicesRequest/id/@entityID) and not($careServicesRequest/id/@entityID = '')) then $careServicesRequest/id/@entityID
  else concat('urn:uuid:', random:uuid())
  let $time :=current-dateTime()
  let $prov := 
  &lt;provider entityID="{$entityID}"&gt;
    {(
      $careServicesRequest/codedType,
      &lt;demographic&gt;
	{(
	  $careServicesRequest/gender,
	  $careServicesRequest/dateOfBirth
	 )}
	 &lt;/demographic&gt;,
	 $careServicesRequest/language,
         $careServicesRequest/specialty,
	 if ($careServicesRequest/status) 
	   then
	   &lt;record created="{$time}" updated="{$time}" status="{$careServicesRequest/status}" sourceDirectory="{$careServicesRequest/sourceDirectory}"/&gt;
	 else 
	   &lt;record created="{$time}" updated="{$time}" status="Active" sourceDirectory="{$careServicesRequest/sourceDirectory}"/&gt;
     )}
  &lt;/provider&gt;
  
  return (
    insert node $prov into /CSD/providerDirectory,  
    csd_blu:wrap_updating_providers(&lt;provider entityID="{$entityID}"/&gt;)
  )

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_facility"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_facility</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_provider_facility</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/facility/@entityID))  then $provs1 else ()
let $facs0 := $provs2/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]
let $facilities := $provs2/facilities[1]
return  
  if ( count($provs2) = 1 and count($facs0) = 0)  (:DO NOT ALLOW SAME ORG TWICE :)
    then
    let $provider:= $provs2[1]
    let $fac :=  &lt;facility entityID="{$careServicesRequest/facility/@entityID}"/&gt;
    let $facs_new :=  &lt;facilities&gt;{$fac}&lt;/facilities&gt;

    let $provs3:=  
    &lt;provider entityID="{$provider/@entityID}"&gt;{$facs_new}&lt;/provider&gt;
    return 
      if (exists($facilities)) 
	then
	(insert node $fac into $facilities, 
	csd_blu:wrap_updating_providers($provs3)
	)
      else
	(
	insert node $facs_new into $provider,
	csd_blu:wrap_updating_providers($provs3)
	)

  else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_organization"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_provider_organization</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_provider_organization</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/organization/@entityID))  then $provs1 else ()
let $orgs0 := $provs2/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
let $organizations := $provs2/organizations[1]
return  
  if ( count($provs2) = 1 and count($orgs0) = 0)  (:DO NOT ALLOW SAME ORG TWICE :)
    then
    let $provider:= $provs2[1]
    let $org :=  &lt;organization entityID="{$careServicesRequest/organization/@entityID}"/&gt;
    let $orgs_new :=  &lt;organizations&gt;{$org}&lt;/organizations&gt;

    let $provs3:=  
    &lt;provider entityID="{$provider/@entityID}"&gt;{$orgs_new}&lt;/provider&gt;
    return 
      if (exists($organizations)) 
	then
	(insert node $org into $organizations, 
	csd_blu:wrap_updating_providers($provs3)
	)
      else
	(
	insert node $orgs_new into $provider,
	csd_blu:wrap_updating_providers($provs3)
	)

  else  csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_service"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_create_service</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_create_service</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/facility/@entityID))  then $provs1 else ()
let $provs3 := if (exists($careServicesRequest/facility/service/@entityID))  then $provs2 else ()
let $provider:=   if ( count($provs3) = 1 ) then $provs3[1] else ()
let $facs := $provider/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]
let $fac := if (count($facs) = 1) then $facs[1] else ()
return if (exists($fac))
  then
  let $position := count($fac/service) +1
  let $srvc := 
  &lt;service entityID="{$careServicesRequest/facility/service/@entityID}"&gt;
    {(
      $careServicesRequest/facility/service/organization,
      $careServicesRequest/facility/service/language,
      $careServicesRequest/facility/service/freeBusyURI
     )}
  &lt;/service&gt;
  let $provs3:=  
  &lt;provider entityID="{$provider/@entityID}"&gt;
    &lt;facilities&gt;
      &lt;facility entityID="{$fac/@entityID}"&gt;
	&lt;service position="{$position}" entityID="{$careServicesRequest/facility/service/@entityID}"/&gt;
      &lt;/facility&gt;
    &lt;/facilities&gt;
  &lt;/provider&gt;
  return 
    (insert node $srvc into $fac ,    
    csd_blu:wrap_updating_providers($provs3)
  )
else   csd_blu:wrap_updating_providers(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/address/@type))  then $provs1 else ()
let $address:= $provs2[1]/demographic/address[@type = $careServicesRequest/address/@type]
return if (exists($address)) then (delete node $address) else ()
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/contactPoint/@position)) 
    then 
    let $providers := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($providers) = 1 )
	then
	let  $cp :=  $providers[1]/demographic/contactPoint[position() = $careServicesRequest/contactPoint/@position]
	return if (exists($cp)) then (delete node $cp) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/credential/codedType/@code) and exists($careServicesRequest/credential/codedType/@codingScheme) ) then $provs1  else ()
let $cred_new := $careServicesRequest/credential
let $code:= $cred_new/codedType/@code
let $codingScheme:= $cred_new/codedType/@codingScheme
let $creds0 := $provs2/credential[@code = $code and @codingScheme = $codingScheme]
return  
  if ( count($provs2) = 1 and count($creds0) = 1)  then
    delete node $creds0[1]
  else
    ()
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_name"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_name</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_name</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/name/@position)) 
    then 
    let $providers := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($providers) = 1 )
	then
	let  $name :=  $providers[1]/demographic/name[position() = $careServicesRequest/name/@position]
	return if (exists($name)) then (delete node $name) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $provs0 := if (exists($careServicesRequest/facility/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/facility/service/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/facility/service/operatingHours/@position)) then $provs1  else ()
let $provs3 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs2,$careServicesRequest/id) else ()
let $oh := $provs3[1]/facilities/facility[upper-case(@entityID) =upper-case($careServicesRequest/facility/@entityID)]/service[position() = $careServicesRequest/facility/service/@position]/operatingHours[position() = $careServicesRequest/facility/service/operatingHours/@position]
return
  if (count($oh) = 1)
    then (delete node $oh) else ()
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_org_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/organization/@entityID))  then $provs1 else ()
let $provs3 := if (exists($careServicesRequest/organization/address/@type))  then $provs2 else ()
let $provider:= $provs3[1]
let $orgs := $provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
let $org := if(count($orgs) =1) then $orgs[1] else ()
let $address := $org/address[@type = $careServicesRequest/organization/address/@type]
return if (exists($address)) then (delete node $address) else ()
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_org_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_org_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/organization/contactPoint/@position) and exists($careServicesRequest/organization/@entityID)) 
    then 
    let $providers := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($providers) = 1 )
	then
	let $orgs := $providers[1]/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
	return
	  if (count($orgs) = 1) then
	    let  $cp :=  $orgs[1]/contactPoint[position() = $careServicesRequest/organization/contactPoint/@position]
	    return if (exists($cp)) then (delete node $cp) else ()
	  else () 
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu" ;
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/otherID/@position)) 
    then 
    let $providers := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($providers) = 1 )
	then
	let  $id :=  $providers[1]/otherID[position() = $careServicesRequest/otherID/@position]
	return if (exists($id)) then (delete node $id) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_provider</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $provs0 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()  
return  if (count($provs0) = 1) then
  delete node $provs0[1] else ()
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_facility"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_facility</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_provider_facility</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/facility/@entityID)) 
    then 
    let $providers := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($providers) = 1 )
	then
	let  $fac :=  $providers[1]/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]
	return if (exists($fac)) then (delete node $fac) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_organization"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_provider_organization</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_provider_organization</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/organization/@entityID)) 
    then 
    let $providers := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($providers) = 1 )
	then
	let  $org :=  $providers[1]/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
	return if (exists($org)) then (delete node $org) else ()
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_service"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_delete_service</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_delete_service</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
  if (exists($careServicesRequest/facility/service/@position) and exists($careServicesRequest/facility/@entityID)) 
    then 
    let $providers := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
    return
      if ( count($providers) = 1 )
	then
	let $facs := $providers[1]/facilities/facility[upper-case(@entityID) = upper-case($careServicesRequest/facility/@entityID)]
	return
	  if (count($facs) = 1) then
	    let  $srvc :=  $facs[1]/service[position() = $careServicesRequest/facility/service/@position]
	    return if (exists($srvc)) then (delete node $srvc) else ()
	  else () 
      else  ()
    else ()      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/address/@type))  then $provs1 else ()
let $provider:= $provs2[1]
let $demo := $provider/demographic
let $address:= $demo/address[@type = $careServicesRequest/address/@type]
return  
  if ( not(exists($address))) then
    csd_blu:wrap_updating_providers(()) (: Address does not exist.  Do not update:)
  else
    let $provs3:=  
    &lt;provider entityID="{$provider/@entityID}"&gt;
      &lt;demographic&gt;&lt;address type="{$careServicesRequest/address/@type}"/&gt;&lt;/demographic&gt;
    &lt;/provider&gt;
    return (
      csd_blu:bump_timestamp($provider),
      replace  node  $address with $careServicesRequest/address
      ,
      csd_blu:wrap_updating_providers($provs3)
    )
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/contactPoint/@position)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $old_cp := $provs1[1]/demographic/contactPoint[position() = $careServicesRequest/contactPoint/@position]
return
  if (count($provs1) = 1 and exists($old_cp)) 
    then
    let $new_cp := $careServicesRequest/contactPoint
    let $provs2 := 
    &lt;provider entityID="{$provs1[1]/@entityID}"&gt;
      &lt;demographic&gt;
	&lt;contactPoint position="{$careServicesRequest/contactPoint/@position}"/&gt;
      &lt;/demographic&gt;
    &lt;/provider&gt;
    return
      (
	csd_blu:bump_timestamp($provs1[1]),
	delete node $old_cp/codeType,
	if (exists($new_cp/codeType)) then insert node $new_cp/codeType into $old_cp else (),
	delete node $old_cp/equipment,
	if (exists($new_cp/equipment)) then insert node $new_cp/equipment into $old_cp else (),
	delete node $old_cp/purpose,
	if (exists($new_cp/purpose)) then insert node $new_cp/purpose into $old_cp else (),
	delete node $old_cp/certificate,
	if (exists($new_cp/certificate)) then insert node $new_cp/certificate into $old_cp else (),
	csd_blu:wrap_updating_providers($provs2)
     )
  else 	csd_blu:wrap_updating_providers(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/credential/codedType/@code) and exists($careServicesRequest/credential/codedType/@codingScheme) ) then $provs1  else ()
let $cred_new := $careServicesRequest/credential
let $code:= $cred_new/codedType/@code
let $codingScheme:= $cred_new/codedType/@codingScheme
let $creds0 := $provs2/credential/codedType[@code = $code and @codingScheme = $codingScheme]
return  
  if ( count($provs2) = 1 and count($creds0) = 1)  (:Update only:)
    then
    let $cred_old := $creds0[1]/..
    let $provider:= $provs2[1]
    let $provs3 := 
      &lt;provider entityID="{$provider/@entityID}"&gt;
	&lt;credential&gt;
	  &lt;codedType code="{$code}" codingScheme="{$codingScheme}"/&gt;
	&lt;/credential&gt;
      &lt;/provider&gt;


    return
      
      (
	csd_blu:bump_timestamp($provider),
	if (exists($cred_new/issuingAuthority)) then
	  (if (exists($cred_old/issuingAuthority)) then (delete node $cred_old/issuingAuthority) else (),
	  insert node $cred_new/issuingAuthority into $cred_old)
	else (),
	if (exists($cred_new/number)) then
	  (if (exists($cred_old/number)) then (delete node $cred_old/number) else (),
	  insert node $cred_new/number into $cred_old)
	else (),
	if (exists($cred_new/credentialIssueDate)) then
	  (if (exists($cred_old/credentialIssueDate)) then (delete node $cred_old/credentialIssueDate) else (),
	  insert node $cred_new/credentialIssueDate into $cred_old)
	else (),
	if (exists($cred_new/credentialRenewalDate)) then
	  (if (exists($cred_old/credentialRenewalDate)) then (delete node $cred_old/credentialRenewalDate) else (),
	  insert node $cred_new/credentialRenewalDate into $cred_old)
	else (),
	csd_blu:wrap_updating_providers($provs3)
       )
  else 	csd_blu:wrap_updating_providers(())
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_name"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_name</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_name</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/name/@position)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $name := $provs1[1]/demographic/name[position() = $careServicesRequest/name/@position]
return
  if (count($provs1) = 1 and exists($name)) 
    then
    let $provs2 := 
    &lt;provider entityID="{$provs1[1]/@entityID}"&gt;
      &lt;demographic&gt;
	&lt;name position="{$careServicesRequest/name/@position}"/&gt;
      &lt;/demographic&gt;
    &lt;/provider&gt;
    let $new_name := 
    &lt;name&gt;
     {$careServicesRequest/name/*}
    &lt;/name&gt;
    return
      (
	csd_blu:bump_timestamp($provs1[1]),
	replace  node $name with $new_name,
	csd_blu:wrap_updating_providers($provs2)
     )
  else 	csd_blu:wrap_updating_providers(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_operating_hours"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_operating_hours</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_operating_hours</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/facility/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/facility/service/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/facility/service/operatingHours/@position)) then $provs1  else ()
let $provs3 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs2,$careServicesRequest/id) else ()
let $oh := $provs3[1]/facilities/facility[upper-case(@entityID) =upper-case($careServicesRequest/facility/@entityID)]/service[position() = $careServicesRequest/facility/service/@position]/operatingHours[position() = $careServicesRequest/facility/service/operatingHours/@position]
return
  if (count($oh) = 1 and count($provs3) = 1)
    then
    let $new_oh := $careServicesRequest/facility/service/operatingHours
    let $provs4 := 
    &lt;provider entityID="{$provs1[1]/@entityID}"&gt;
      &lt;facilities&gt;
	&lt;facility entityID="{$careServicesRequest/facility/@entityID}"&gt;
	  &lt;service position="{$careServicesRequest/facility/service/@position}" &gt;
	    &lt;operatingHours position="{$careServicesRequest/facility/service/operatingHours/@position}"/&gt;
	  &lt;/service&gt;
	&lt;/facility&gt;
      &lt;/facilities&gt;
    &lt;/provider&gt;
    return
      (
	csd_blu:bump_timestamp($provs3[1]),
	delete node $oh/openFlag,
	if (exists($new_oh/openFlag)) then insert node $new_oh/openFlag into $oh else (),
	delete node $oh/dayOfTheWeek,
	if (exists($new_oh/dayOfTheWeek)) then insert node $new_oh/dayOfTheWeek into $oh else (),
	delete node $oh/beginningHour,
	if (exists($new_oh/beginningHour)) then insert node $new_oh/beginningHour into $oh else (),
	delete node $oh/endingHour,
	if (exists($new_oh/endingHour)) then insert node $new_oh/endingHour into $oh else (),
	delete node $oh/beginEffectiveDate,
	if (exists($new_oh/beginEffectiveDate)) then insert node $new_oh/beginEffectiveDate into $oh else (),
	delete node $oh/endEffectiveDate,
	if (exists($new_oh/endEffectiveDate)) then insert node $new_oh/endEffectiveDate into $oh else (),
	csd_blu:wrap_updating_providers($provs4)
     )
  else 	csd_blu:wrap_updating_providers(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_org_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $provs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()
let $provs1 := if (count($provs0) = 1) then $provs0 else ()
let $provs2 := if (exists($careServicesRequest/organization/@entityID))  then $provs1 else ()
let $provs3 := if (exists($careServicesRequest/organization/address/@type))  then $provs2 else ()
let $provider:= $provs3[1]
let $org_container := $provider/organizations[1]
let $orgs := $provider/organizations/organization[upper-case(@entityID) = upper-case($careServicesRequest/organization/@entityID)]
let $org := if(count($orgs) =1) then $orgs[1] else ()
let $address := $org/address[@type = $careServicesRequest/organization/address/@type]
return if (not(exists($address)))
  then   csd_blu:wrap_updating_providers((&lt;bad0/&gt;,$careServicesRequest)) (:do not update an non-existent one :)
else
  (
    csd_blu:bump_timestamp($provider),
    replace node $address with  $careServicesRequest/organization/address ,
     csd_blu:wrap_updating_providers(    
       &lt;provider entityID="{$provider/@entityID}"&gt;
	 &lt;organizations&gt;
	   &lt;organization entityID="{$org/@entityID}"&gt;
	     &lt;contactPoint position="{$address/@type}"/&gt;
	   &lt;/organization&gt;
	 &lt;/organizations&gt;
       &lt;/provider&gt;
    )
)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_org_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_org_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/organization/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/organization/contactPoint/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs1,$careServicesRequest/id) else ()
let $old_cp := $provs2[1]/organizations/organization[upper-case(@entityID) =upper-case($careServicesRequest/organization/@entityID)]/contactPoint[position() = $careServicesRequest/organization/contactPoint/@position]
return
  if (count($provs2) = 1 and exists($old_cp)) 
    then
    let $new_cp := $careServicesRequest/organization/contactPoint
    let $provs3 := 
    &lt;provider entityID="{$provs1[1]/@entityID}"&gt;
      &lt;organizations&gt;
	&lt;organization entityID="{$careServicesRequest/organization/@entityID}"&gt;
	  &lt;contactPoint position="{$careServicesRequest/organization/contactPoint/@position}"/&gt;
	&lt;/organization&gt;
      &lt;/organizations&gt;
    &lt;/provider&gt;
    return
      (
	csd_blu:bump_timestamp($provs2[1]),
	delete node $old_cp/codeType,
	if (exists($new_cp/codeType)) then insert node $new_cp/codeType into $old_cp else (),
	delete node $old_cp/equipment,
	if (exists($new_cp/equipment)) then insert node $new_cp/equipment into $old_cp else (),
	delete node $old_cp/purpose,
	if (exists($new_cp/purpose)) then insert node $new_cp/purpose into $old_cp else (),
	delete node $old_cp/certificate,
	if (exists($new_cp/certificate)) then insert node $new_cp/certificate into $old_cp else (),
	csd_blu:wrap_updating_providers($provs3)
     )
  else 	csd_blu:wrap_updating_providers(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/otherID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs0,$careServicesRequest/id) else ()
let $id := $provs1[1]/otherID[position() = $careServicesRequest/otherID/@position]
return
  if (count($provs1) = 1 and exists($id)) 
    then
    let $provs2 := 
    &lt;provider entityID="{$provs1[1]/@entityID}"&gt;
      &lt;otherID position="{$careServicesRequest/otherID/@position}"/&gt;
    &lt;/provider&gt;
    return
      (
	csd_blu:bump_timestamp($provs1[1]),
	if ($careServicesRequest/otherID/@code) 
	  then 	    
	    if (exists($id/@code))
	      then  (replace value of node $id/@code with $careServicesRequest/otherID/@code)
	      else (insert node  $careServicesRequest/otherID/@code into $id)
	  else (),
	if (exists($careServicesRequest/otherID/@assigningAuthorityName) )
	  then 
	    if (exists($id/@assigningAuthorityName))
	      then replace value of node $id/@assigningAuthorityName with $careServicesRequest/otherID/@assigningAuthorityName
	      else insert node $careServicesRequest/otherID/@assigningAuthorityName into $id		
	  else (),
	if (not(string($careServicesRequest/otherID) = '')) 
	  then (replace value of node $id with string($careServicesRequest/otherID))
	  else (),
	csd_blu:wrap_updating_providers($provs2)
     )
  else 	csd_blu:wrap_updating_providers(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_provider</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:) 
let $provs0 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id(/CSD/providerDirectory/*,$careServicesRequest/id) else ()  
return
  if (not (count($provs0) = 1)) 
    then ( csd_blu:wrap_updating_providers((&lt;bad/&gt;)))     (:do nothing :)
  else
    let $provider := $provs0[1]
    let $demo := $provider/demographic
    let $dob := $demo/dateOfBirth
    let $gender := $demo/gender
    return 
      (
	csd_blu:bump_timestamp($provider),
	delete node $provider/codedType,
	insert node $careServicesRequest/codedType into $provider,
	if (not(exists($demo)))
	  then
	  insert node
	  &lt;demographic&gt;
	    {($careServicesRequest/gender,$careServicesRequest/dateOfBirth)}
	  &lt;/demographic&gt;
	  into $provider	
	else	
	  (
	    if (not(exists($dob))) then  insert node $careServicesRequest/dateOfBirth into $demo else replace value of node  $demo/dateOfBirth with $careServicesRequest/dateOfBirth,
	    if (not(exists($gender))) then  insert node $careServicesRequest/gender into $demo else replace value of node  $demo/gender with $careServicesRequest/gender
	),
	delete node $provider/language,
	insert node $careServicesRequest/language into $provider,
	delete node $provider/specialty,
	insert node $careServicesRequest/specialty into $provider,
	if (exists($provider/record/@status)) 
	  then replace value of node $provider/record/@status with $careServicesRequest/status 
	else insert node attribute { 'status' } { string($careServicesRequest/status) } into $provider/record,
	csd_blu:wrap_updating_providers(&lt;provider entityID="{$provider/@entityID}" /&gt;)
    )

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_facility"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_facility</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_provider_facility</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
() (: does nothing:)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_organization"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_provider_organization</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_provider_organization</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
() (: does nothing:)
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_service"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:health_worker_update_service</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">health_worker_update_service</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   
let $provs0 := if (exists($careServicesRequest/facility/@entityID)) then /CSD/providerDirectory/*  else ()
let $provs1 := if (exists($careServicesRequest/facility/service/@position)) then $provs0  else ()
let $provs2 := if (exists($careServicesRequest/id/@entityID)) then csd_bl:filter_by_primary_id($provs1,$careServicesRequest/id) else ()
let $old_srvc := $provs2[1]/facilities/facility[upper-case(@entityID) =upper-case($careServicesRequest/facility/@entityID)]/service[position() = $careServicesRequest/facility/service/@position]
return
  if (count($provs2) = 1 and exists($old_srvc)) 
    then
    let $new_srvc := $careServicesRequest/facility/service
    let $provs3 := 
    &lt;provider entityID="{$provs1[1]/@entityID}"&gt;
      &lt;facilities&gt;
	&lt;facility entityID="{$careServicesRequest/facility/@entityID}"&gt;
	  &lt;service position="{$careServicesRequest/facility/service/@position}" /&gt;
	&lt;/facility&gt;
      &lt;/facilities&gt;
    &lt;/provider&gt;
    return
      (
	csd_blu:bump_timestamp($provs2[1]),
	delete node $old_srvc/freeBusyURI,
	if (exists($new_srvc/freeBusyURI)) then insert node $new_srvc/freeBusyURI into $old_srvc else (),
	delete node $old_srvc/organization,
	if (exists($new_srvc/organization)) then insert node $new_srvc/organization into $old_srvc else (),
	delete node $old_srvc/language,
	if (exists($new_srvc/language)) then insert node $new_srvc/language into $old_srvc else (),
	csd_blu:wrap_updating_providers($provs3)
     )
  else 	csd_blu:wrap_updating_providers(())

</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:facility_create_address</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">facility_create_address</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $fac0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/facilityDirectory/*,$careServicesRequest/id) else ()
let $fac1 := if (count($fac0) = 1) then $fac0 else ()
let $fac2 := if (exists($careServicesRequest/address/@type))  then $fac1 else ()
return  
  if ( count($fac2) = 1 )
    then
    let $facility:= $fac2[1]
    return
      let $fac3:=  
      &lt;facility entityID="{$facility/@entityID}"&gt;
        &lt;address type="{$careServicesRequest/address/@type}"/&gt;
      &lt;/facility&gt;
       return (
	   insert node
	   $careServicesRequest/address
	   into $facility
	   ,
	csd_blu:wrap_updating_facilities($fac3)
	)
  else  csd_blu:wrap_updating_facilities(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_create_contact_point"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_create_contact_point</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_create_contact_point</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $orgs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) else ()
let $orgs1 := if (count($orgs0) = 1) then $orgs0 else ()
let $orgs2 := if (exists($careServicesRequest/contactPoint))  then $orgs1 else ()
return  
  if ( count($orgs2) = 1 )
    then
    let $organization:= $orgs2[1]
    let $position := count($organization/contactPoint) +1
    let $cp := 
      &lt;contactPoint&gt;
	{(
	  if (exists($careServicesRequest/contactPoint/codedType)) then  $careServicesRequest/contactPoint/codedType else (),
	  if (exists($careServicesRequest/contactPoint/equipment)) then  $careServicesRequest/contactPoint/equipment else (),
	  if (exists($careServicesRequest/contactPoint/purpose)) then  $careServicesRequest/contactPoint/purpose else (),
	  if (exists($careServicesRequest/contactPoint/certificate)) then  $careServicesRequest/contactPoint/certificate else ()
	 )}
      &lt;/contactPoint&gt;
    let $orgs3:=  
    &lt;organization entityID="{$organization/@entityID}"&gt;
	&lt;contactPoint position="{$position}"/&gt;
    &lt;/organization&gt;
    return 
      (insert node $cp into $organization ,    
      csd_blu:wrap_updating_organizations($orgs3)
      )
  else  csd_blu:wrap_updating_organizations(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_create_credential"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_create_credential</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_create_credential</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $orgs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) else ()
let $orgs1 := if (count($orgs0) = 1) then $orgs0 else ()
let $orgs2 := if (exists($careServicesRequest/credential/codedType/@code) and exists($careServicesRequest/credential/codedType/@codingScheme) ) then $orgs1  else ()
let $cred_request := $careServicesRequest/credential
let $code:= $cred_request/codedType/@code
let $codingScheme:= $cred_request/codedType/@codingScheme
let $creds0 := $orgs2/credential/codedType[@code = $code and @codingScheme = $codingScheme]
return  
  if ( count($orgs2) = 1 and count($creds0) = 0)  (:DO NOT ALLOW SAME CRED TWICE :)
    then
    let $organization:= $orgs2[1]
    let $cred_rec :=
    &lt;credential&gt;
      &lt;codedType code="{$code}" codingScheme="{$codingScheme}"/&gt;
    &lt;/credential&gt;
    let $cred_new :=
    &lt;credential&gt;
      &lt;codedType code="{$code}" codingScheme="{$codingScheme}"/&gt;
      {(
	if (exists($cred_request/number)) then $cred_request/number else (),
	if (exists($cred_request/issuingAuthority)) then $cred_request/issuingAuthority else (),
	if (exists($cred_request/credentialIssueDate)) then $cred_request/credentialIssueDate else (),
        if (exists($cred_request/credentialRenewalDate)) then $cred_request/credentialRenewalDate else ()
      )}
    &lt;/credential&gt;
    let $orgs3:=  
    &lt;organization entityID="{$organization/@entityID}"&gt;{$cred_rec}&lt;/organization&gt;
    return 
	(
	insert node $cred_new into $organization,
	csd_blu:wrap_updating_organizations($orgs3)
	)

  else  csd_blu:wrap_updating_organizations(())
      
</pre></span>
      </div>
    </div>
    <a id="urn:openhie.org:openinfoman-hwr:stored-function:organization_create_otherid"/>
    <div class="function">
      <div class="callout">
        <span class="attribute">Content-Type: 
        text/xml<br/>
	URN: urn:openhie.org:openinfoman-hwr:stored-function:organization_create_otherid</span>
        <h2>Description</h2>
        <br/>
        <br/>
        <span class="source">organization_create_otherid</span>
        <h2>Definition            </h2>
        <span class="source">Source: 
	<pre>import module namespace csd_bl = "https://github.com/openhie/openinfoman/csd_bl";
import module namespace csd_blu = "https://github.com/openhie/openinfoman/csd_blu";
declare default element  namespace   "urn:ihe:iti:csd:2013";
declare variable $careServicesRequest as item() external;

(: 
   The query will be executed against the root element of the CSD document.
   
   The dynamic context of this query has $careServicesRequest set to contain any of the search 
   and limit paramaters as sent by the Service Finder
:)   

let $orgs0 := if (exists($careServicesRequest/id/@entityID)) then	csd_bl:filter_by_primary_id(/CSD/organizationDirectory/*,$careServicesRequest/id) else ()
let $orgs1 := if (count($orgs0) = 1) then $orgs0 else ()
let $orgs2 := if (exists($careServicesRequest/otherID/@code))  then $orgs1 else ()
return  
  if ( count($orgs2) = 1 )
    then
    let $organization:= $orgs2[1]
    let $position := count($organization/otherID) +1
    let $id := 
      if (exists($careServicesRequest/otherID/@assigningAuthorityName)) then
      &lt;otherID code="{$careServicesRequest/otherID/@code}" assigningAuthorityName="{$careServicesRequest/otherID/@assigningAuthorityName}"&gt;{string($careServicesRequest/otherID)}&lt;/otherID&gt;
    else 
      &lt;otherID code="{$careServicesRequest/otherID/@code}"&gt;{string($careServicesRequest/otherID)}&lt;/otherID&gt;
    let $orgs3:=  
    &lt;organization entityID="{$organization/@entityID}"&gt;
      &lt;otherID position="{$position}"/&gt;
    &lt;/organization&gt;
    return 
      (insert node $id into $organization ,    
      csd_blu:wrap_updating_organizations($orgs3)
      )
  else  csd_blu:wrap_updating_organizations(())
      
</pre></span>
      </div>
    </div>
  </body>
</html>
