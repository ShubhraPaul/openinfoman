<?xml version="1.0" encoding="US-ASCII"?>
<xhtml:html xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
            xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
            xmlns:xhtml="http://www.w3.org/1999/xhtml"
            xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"
            xmlns:xforms="http://www.w3.org/2002/xforms"
            xmlns:chiba="http://chiba.sourceforge.net/xforms"
            xmlns:events="http://www.w3.org/2001/xml-events"
            xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            xmlns:xtee="http://x-tee.riik.ee/xsd/xtee.xsd"
            xmlns:mteenus="http://producers.mteenus.xtee.riik.ee/producer/mteenus">
   <xhtml:head>
      <xhtml:title>MMS teavitus</xhtml:title>
      <xforms:model>
         <xforms:instance id="mteenus.MMSteavitus.v1.input">
            <SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
               <SOAP-ENV:Header>
                  <xtee:asutus>70006317</xtee:asutus>
                  <xtee:andmekogu>mteenus</xtee:andmekogu>
                  <xtee:isikukood>EE37605124217</xtee:isikukood>
                  <xtee:id>735c380d1c319482355c2a28977fa4cc0ada041b</xtee:id>
                  <xtee:nimi>mteenus.MMSteavitus.v1</xtee:nimi>
                  <xtee:amet>tester</xtee:amet>
                  <xtee:toimik>1</xtee:toimik>
                  <xtee:ametnik>37605124217</xtee:ametnik>
               </SOAP-ENV:Header>
               <SOAP-ENV:Body>
                  <ns5:MMSteavitus xmlns:ns5="http://producers.mteenus.xtee.riik.ee/producer/mteenus">
                     <keha xsi:nil="false">
                        <teenusId xsi:nil="true" xsi:type="xsd:string"/>
                        <mobiil xsi:nil="true" xsi:type="xsd:string"/>
                        <isikukood xsi:nil="true" xsi:type="xsd:string"/>
                        <saatja_number xsi:nil="true" xsi:type="xsd:string"/>
                        <sisu xsi:nil="true" xsi:type="xsd:string"/>
                        <kinnitus xsi:nil="true" xsi:type="xsd:boolean">false</kinnitus>
                        <tkalparams xsi:nil="true" xsi:type="xsd:string"/>
                        <asukoht xsi:nil="false">
                           <kordinaadid xsi:nil="true" xsi:type="xsd:string"/>
                           <raadius xsi:nil="true" xsi:type="xsd:float"/>
                           <aadress xsi:nil="false">
                              <koik_aadressid xsi:nil="true" xsi:type="xsd:boolean">false</koik_aadressid>
                              <ehak xmlns:tns="http://x-tee.riik.ee/xsd/xtee.xsd" xsi:nil="true" xsi:type="tns:ehak"
                                    maakond=""
                                    vald=""/>
                              <tanav xsi:nil="true" xsi:type="xsd:string"/>
                              <majaNr xsi:nil="true" xsi:type="xsd:string"/>
                              <korter xsi:nil="true" xsi:type="xsd:string"/>
                           </aadress>
                        </asukoht>
                        <failid xsi:nil="false" xsi:type="SOAP-ENC:Array" SOAP-ENC:arrayType="">
                           <insert-trigger-d5e1191/>
                           <delete-trigger-d5e1191/>
                           <item xsi:nil="false">
                              <name xsi:nil="true" xsi:type="xsd:string"/>
                              <type xsi:nil="true" xsi:type="xsd:string"/>
                              <data xsi:nil="true" xsi:type="xsd:base64Binary"/>
                           </item>
                        </failid>
                     </keha>
                  </ns5:MMSteavitus>
               </SOAP-ENV:Body>
            </SOAP-ENV:Envelope>
         </xforms:instance>
         <xforms:instance id="mteenus.MMSteavitus.v1.output">
            <SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
         </xforms:instance>
         <xforms:instance id="temp">
            <temp>
               <relevant xsi:type="boolean">true</relevant>
            </temp>
         </xforms:instance>
         <xforms:instance id="texts">
            <texts>
               <boolean value="true">jah</boolean>
               <boolean value="false">ei</boolean>
               <no_data>Andmeid ei tulnud.</no_data>
            </texts>
         </xforms:instance>
         <xforms:instance id="ehak" src="{$contextroot}/forms/xteeportal/classifiers/ehak.xml"/>
         <xforms:bind nodeset="instance('mteenus.MMSteavitus.v1.input')/SOAP-ENV:Body/mteenus:MMSteavitus">
            <xforms:bind nodeset="keha">
               <xforms:bind nodeset="teenusId"/>
               <xforms:bind nodeset="mobiil"/>
               <xforms:bind nodeset="isikukood"/>
               <xforms:bind nodeset="saatja_number"/>
               <xforms:bind nodeset="sisu"/>
               <xforms:bind nodeset="kinnitus"/>
               <xforms:bind nodeset="tkalparams"/>
               <xforms:bind nodeset="asukoht">
                  <xforms:bind nodeset="kordinaadid"/>
                  <xforms:bind nodeset="raadius"/>
                  <xforms:bind nodeset="aadress">
                     <xforms:bind nodeset="koik_aadressid"/>
                     <xforms:bind nodeset="ehak" constraint=". = '' or (chiba:match(., '\d{4}',''))">
                        <xforms:bind nodeset="@maakond" relevant="boolean-from-string(instance('temp')/relevant)"/>
                        <xforms:bind nodeset="@vald" relevant="boolean-from-string(instance('temp')/relevant)"/>
                     </xforms:bind>
                     <xforms:bind nodeset="tanav"/>
                     <xforms:bind nodeset="majaNr"/>
                     <xforms:bind nodeset="korter"/>
                  </xforms:bind>
               </xforms:bind>
               <xforms:bind nodeset="failid"
                            relevant="(. != '' or boolean-from-string(instance('temp')/relevant))">
                  <xforms:bind nodeset="@SOAP-ENC:arrayType"
                               calculate="concat('xsd:anyType[',count(../*) - 3,']')"/>
                  <xforms:bind nodeset="item">
                     <xforms:bind nodeset="name">
                        <xforms:bind nodeset="@xsi:nil" relevant="false()"/>
                     </xforms:bind>
                     <xforms:bind nodeset="type">
                        <xforms:bind nodeset="@xsi:nil" relevant="false()"/>
                     </xforms:bind>
                     <xforms:bind nodeset="data">
                        <xforms:bind nodeset="@xsi:nil" relevant="false()"/>
                     </xforms:bind>
                     <xforms:bind nodeset="@xsi:nil" relevant="false()"/>
                  </xforms:bind>
                  <xforms:bind nodeset="insert-trigger-d5e1191"
                               relevant="((count(../item) - 1) &lt; 1000) and boolean-from-string(instance('temp')/relevant)"/>
                  <xforms:bind nodeset="delete-trigger-d5e1191"
                               relevant="((count(../item) - 1) &gt; 0) and boolean-from-string(instance('temp')/relevant)"/>
                  <xforms:bind nodeset="item[count(../item)]" relevant="false()"/>
               </xforms:bind>
               <xforms:bind nodeset="@xsi:nil" relevant="false()"/>
            </xforms:bind>
         </xforms:bind>
         <xforms:bind nodeset="instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Body/mteenus:MMSteavitusResponse">
            <xforms:bind nodeset="keha">
               <xforms:bind nodeset="result">
                  <xforms:bind nodeset="resultCode" type="xsd:int"/>
                  <xforms:bind nodeset="resultText" type="xsd:string"/>
               </xforms:bind>
               <xforms:bind nodeset="kirjeteArv" type="xsd:int"/>
            </xforms:bind>
         </xforms:bind>
         <xforms:submission id="mteenus.MMSteavitus.v1.submission"
                            action="http://localhost:3000/cgi-bin/consumer_proxy"
                            mediatype="text/xml"
                            ref="instance('mteenus.MMSteavitus.v1.input')"
                            method="post"
                            replace="instance"
                            instance="mteenus.MMSteavitus.v1.output">
            <xforms:action events:event="xforms-submit">
               <xforms:setvalue ref="instance('temp')/relevant" value="false()"/>
            </xforms:action>
            <xforms:action events:event="xforms-submit-done">
               <xforms:setvalue ref="instance('temp')/relevant" value="true()"/>
               <xforms:toggle case="mteenus.MMSteavitus.v1.response"/>
            </xforms:action>
            <xforms:action events:event="xforms-submit-error">
               <xforms:setvalue ref="instance('temp')/relevant" value="true()"/>
            </xforms:action>
            <xforms:message level="modal" events:event="xforms-submit-error">Veendu, et k&#245;ik v&#228;ljad on korrektselt t&#228;idetud!</xforms:message>
         </xforms:submission>
         <xforms:submission id="mteenus.MMSteavitus.v1.debug"
                            action="{$contextroot}/resources/jsp/debug-instance.jsp"
                            mediatype="text/xml"
                            ref="instance('mteenus.MMSteavitus.v1.input')"
                            method="post"
                            replace="all"
                            validate="false">
            <xforms:action events:event="xforms-submit">
               <xforms:setvalue ref="instance('temp')/relevant" value="false()"/>
            </xforms:action>
            <xforms:action events:event="xforms-submit-done">
               <xforms:setvalue ref="instance('temp')/relevant" value="true()"/>
               <xforms:toggle case="mteenus.MMSteavitus.v1.response"/>
            </xforms:action>
            <xforms:action events:event="xforms-submit-error">
               <xforms:setvalue ref="instance('temp')/relevant" value="true()"/>
            </xforms:action>
            <xforms:message level="modal" events:event="xforms-submit-error">Veendu, et k&#245;ik v&#228;ljad on korrektselt t&#228;idetud!</xforms:message>
         </xforms:submission>
         <xforms:submission id="mteenus.MMSteavitus.v1.savexml"
                            action="{$contextroot}/resources/jsp/return-instance.jsp"
                            mediatype="text/xml"
                            ref="instance('mteenus.MMSteavitus.v1.output')"
                            method="post"
                            replace="all"/>
         <xforms:toggle case="mteenus.MMSteavitus.v1.request" events:event="xforms-ready"
                        if="not(boolean(instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Body))"/>
         <xforms:toggle case="mteenus.MMSteavitus.v1.response" events:event="xforms-ready"
                        if="boolean(instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Body)"/>
      </xforms:model>
   </xhtml:head>
   <xhtml:body>
      <xhtml:h1>MMS teavitus</xhtml:h1>
      <xforms:switch>
         <xforms:case id="mteenus.MMSteavitus.v1.request">
            <xforms:group ref="instance('mteenus.MMSteavitus.v1.input')/SOAP-ENV:Body/mteenus:MMSteavitus">
               <xforms:group ref="keha">
                  <xforms:input ref="teenusId">
                     <xforms:label>Teenuse ID</xforms:label>
                  </xforms:input>
                  <xforms:input ref="mobiil">
                     <xforms:label>Mobiil</xforms:label>
                  </xforms:input>
                  <xforms:input ref="isikukood">
                     <xforms:label>Isikukood</xforms:label>
                  </xforms:input>
                  <xforms:input ref="saatja_number">
                     <xforms:label>Saatja telefoninumber</xforms:label>
                  </xforms:input>
                  <xforms:textarea ref="sisu" style="height: 5em;width: 25em;">
                     <xforms:label>Teatele lisatav tekst</xforms:label>
                  </xforms:textarea>
                  <xforms:input ref="kinnitus">
                     <xforms:label>Saada teavitus kinnitusega</xforms:label>
                  </xforms:input>
                  <xforms:input ref="tkalparams">
                     <xforms:label>Teavituskalendri parameetrid</xforms:label>
                  </xforms:input>
                  <xforms:group ref="asukoht">
                     <xforms:label>Asukoht</xforms:label>
                     <xforms:input ref="kordinaadid">
                        <xforms:label>Koordinaadid x,y </xforms:label>
                     </xforms:input>
                     <xforms:input ref="raadius">
                        <xforms:label>Teavitus raadius </xforms:label>
                     </xforms:input>
                     <xforms:group ref="aadress">
                        <xforms:label>Aadress</xforms:label>
                        <xforms:input ref="koik_aadressid">
                           <xforms:label>Saada k&#245;igile aadressidele</xforms:label>
                        </xforms:input>
                        <xforms:group>
                           <xforms:label>Aadressi EHAK</xforms:label>
                           <xforms:select1 ref="ehak/@maakond">
                              <xforms:label>Maakond</xforms:label>
                              <xforms:itemset nodeset="instance('ehak')/maakond">
                                 <xforms:label ref="@nimi"/>
                                 <xforms:value ref="@kood"/>
                              </xforms:itemset>
                           </xforms:select1>
                           <xforms:select1 ref="ehak/@vald">
                              <xforms:label>Vald</xforms:label>
                              <xforms:itemset nodeset="instance('ehak')/maakond[@kood=instance('mteenus.MMSteavitus.v1.input')/SOAP-ENV:Body/mteenus:MMSteavitus/keha/asukoht/aadress/ehak/@maakond]/vald">
                                 <xforms:label ref="@nimi"/>
                                 <xforms:value ref="@kood"/>
                              </xforms:itemset>
                           </xforms:select1>
                           <xforms:select1 ref="ehak">
                              <xforms:label>Asula</xforms:label>
                              <xforms:itemset nodeset="instance('ehak')/maakond[@kood=instance('mteenus.MMSteavitus.v1.input')/SOAP-ENV:Body/mteenus:MMSteavitus/keha/asukoht/aadress/ehak/@maakond]/vald[@kood=instance('mteenus.MMSteavitus.v1.input')/SOAP-ENV:Body/mteenus:MMSteavitus/keha/asukoht/aadress/ehak/@vald]/asula">
                                 <xforms:label ref="@nimi"/>
                                 <xforms:value ref="@kood"/>
                              </xforms:itemset>
                           </xforms:select1>
                        </xforms:group>
                        <xforms:input ref="tanav">
                           <xforms:label>T&#228;nav</xforms:label>
                        </xforms:input>
                        <xforms:input ref="majaNr">
                           <xforms:label>Maja number</xforms:label>
                        </xforms:input>
                        <xforms:input ref="korter">
                           <xforms:label>Korter</xforms:label>
                        </xforms:input>
                     </xforms:group>
                  </xforms:group>
                  <xforms:group ref="failid">
                     <xforms:label>Saadetavad failid MMS s&#245;numile</xforms:label>
                     <xforms:repeat nodeset="item" id="repeat-d5e1191">
                        <xforms:input ref="name">
                           <xforms:label>Failinimi</xforms:label>
                        </xforms:input>
                        <xforms:input ref="type">
                           <xforms:label>Sisu MIME t&#252;&#252;p</xforms:label>
                        </xforms:input>
                        <xforms:upload ref="data">
                           <xforms:label>Fail</xforms:label>
                        </xforms:upload>
                     </xforms:repeat>
                     <xforms:trigger ref="insert-trigger-d5e1191">
                        <xforms:label>Lisa</xforms:label>
                        <xforms:insert events:event="DOMActivate" nodeset="../item" at="last()" position="before"/>
                     </xforms:trigger>
                     <xforms:trigger ref="delete-trigger-d5e1191">
                        <xforms:label>Kustuta</xforms:label>
                        <xforms:delete events:event="DOMActivate" nodeset="../item" at="index('repeat-d5e1191')"/>
                        <xforms:setindex events:event="DOMActivate" repeat="repeat-d5e1191"
                                         index="if(index('repeat-d5e1191') = count(../item), index('repeat-d5e1191') - 1, index('repeat-d5e1191'))"/>
                     </xforms:trigger>
                  </xforms:group>
               </xforms:group>
            </xforms:group>
            <xforms:group class="actions">
               <xforms:submit submission="mteenus.MMSteavitus.v1.submission">
                  <xforms:label>Esita p&#228;ring</xforms:label>
               </xforms:submit>
               <xforms:submit submission="mteenus.MMSteavitus.v1.debug">
                  <xforms:label>Debug</xforms:label>
               </xforms:submit>
            </xforms:group>
         </xforms:case>
         <xforms:case id="mteenus.MMSteavitus.v1.response">
            <xforms:group ref="instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Header">
               <xforms:output ref="xtee:id" class="serviceid">
                  <xforms:label>P&#228;ringu id</xforms:label>
               </xforms:output>
            </xforms:group>
            <xforms:group ref="instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Body/mteenus:MMSteavitusResponse">
               <xforms:group ref="keha">
                  <xforms:group ref="result">
                     <xforms:label>P&#228;ringu tulemus</xforms:label>
                     <xforms:output ref="resultCode">
                        <xforms:label>Vea kood</xforms:label>
                     </xforms:output>
                     <xforms:output ref="resultText">
                        <xforms:label>Veateade</xforms:label>
                     </xforms:output>
                  </xforms:group>
                  <xforms:output ref="kirjeteArv">
                     <xforms:label>Saadetud s&#245;numite arv</xforms:label>
                  </xforms:output>
               </xforms:group>
            </xforms:group>
            <xforms:group ref="instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Body/mteenus:MMSteavitusResponse[keha = '']"
                          class="info">
               <xforms:output ref="instance('texts')/no_data"/>
            </xforms:group>
            <xforms:group ref="instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Body/mteenus:MMSteavitusResponse/keha/faultString"
                          class="info">
               <xforms:output ref="."/>
            </xforms:group>
            <xforms:group ref="instance('mteenus.MMSteavitus.v1.output')/SOAP-ENV:Body/SOAP-ENV:Fault"
                          class="fault">
               <xforms:output ref="faultstring"/>
            </xforms:group>
            <xforms:group class="actions">
               <xforms:trigger>
                  <xforms:label>Uuesti</xforms:label>
                  <xforms:toggle events:event="DOMActivate" case="mteenus.MMSteavitus.v1.request"/>
               </xforms:trigger>
               <xforms:submit submission="mteenus.MMSteavitus.v1.savexml">
                  <xforms:label>Show XML</xforms:label>
               </xforms:submit>
            </xforms:group>
         </xforms:case>
      </xforms:switch>
   </xhtml:body>
</xhtml:html>